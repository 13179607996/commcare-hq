

<project name="cchq_main_build" default="compile">

	
	<property name="project.dir" value="."/>
	<property name="apps.dir" value="../../apps"/>	
	<property name="pydoc.dir" value="../../pydocs"/>
	<property name="libs.dir" value="../../libs" />
	<property name="scripts.dir" value="../../scripts" />
	<property name="antdepends.dir" value="../../antdepends" />
	
	
	<taskdef resource="pyAntTasks.properties" classpath="${antdepends.dir}/pyAntTasks-1.3.jar"/>
	<taskdef name="py-run" classname="org.pyant.tasks.PythonRunTask" classpath="${antdepends.dir}/pyAntTasks-1.3.jar"/>
	<taskdef name="py-compile" classname="org.pyant.tasks.PythonCompileTask" classpath="${antdepends.dir}/pyAntTasks-1.3.jar"/>
	<taskdef name="py-test" classname="org.pyant.tasks.PythonTestTask" classpath="${antdepends.dir}/pyAntTasks-1.3.jar"/>
	<taskdef name="py-doc" classname="org.pyant.tasks.PythonDocTask" classpath="${antdepends.dir}/pyAntTasks-1.3.jar"/>
	
	<target name="init">
		<mkdir dir="${pydoc.dir}"/>
	</target>
	
	<!--
		    Clean out any compiled code or files generated by the build.
	-->
	<target name="clean" depends="init">
		<delete>
			<fileset dir="${project.dir}">
		    	<include name="**/*.pyc"/>
		        <include name="**/*.pyo"/>
		    </fileset>
			<fileset dir="${apps.dir}">
				<include name="**/*.pyc"/>
				<include name="**/*.pyo"/>
			</fileset>
			<fileset dir="${libs.dir}">
				<include name="**/*.pyc"/>
				<include name="**/*.pyo"/>
			</fileset>
			<fileset dir="${scripts.dir}">
				<include name="**/*.pyc"/>
				<include name="**/*.pyo"/>
			</fileset>
		    <fileset dir="${pydoc.dir}">
		    	<include name="**/*"/>
			</fileset>
		</delete>
	</target>

	
	<target name="compile">
		<py-compile dir="${project.dir}" pythonpath="${project.dir}" optimize="0"/>
	</target>	

	<!--
		Execute Non Django Python unit tests.
		This will treat any files under src/ that end in Test.py as a Python
		unit test module.
	-->
	<target name="libtests" depends="compile">
		<py-test pythonpath="${project.dir}" dir="${project.dir}">
			<fileset dir="${libs.dir}">
				<include name="**/*Test.py"/>
			</fileset>
		</py-test>
	</target>	
	
	<target name="django-tests-all" depends="compile">
		<py-run script="manage.py" pythonpath="${project.dir}" optimize="0">
			<arg value="test" />
		</py-run>
	</target>
	
	<target name="syncdb" depends="django-tests-all">
		<py-run script="manage.py" pythonpath="${project.dir}">
			<arg value="syncdb" />
			<arg value="--noinput" />
			</py-run>
	</target>
		
	<target name="pydoc" depends="init,compile">
		<py-doc pythonpath="${project.dir}" destdir="${pydoc.dir}">
			<fileset dir="${project.dir}">
				<include name="**/*"/>
			</fileset>
		</py-doc>
	</target>
</project>





	