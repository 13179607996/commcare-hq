{% load i18n %}
<div class="chartblock">
<h1>{{chart.title}}</h1>
<div id="{{chart.id}}-placeholder" style="width:{{width}}px;height:{{height}}px;"></div>	
<h4>Show Series</h4>
<ul id="{{chart.id}}-choices"></ul>	
</div>
<script id="{{chart.id}}-source" language="javascript" type="text/javascript">
$(function () {
    var datasets = {{chart.get_flot_data|safe}};

//    var mindate = {{mindate}};
//    var maxdate = {{maxdate}};
    
    // hard-code color indices to prevent them from shifting as
    // countries are turned on/off
    var i = 0;
    $.each(datasets, function(key, val) {
        val.color = i;
        ++i;
    });

    //$("#whole").click(function () {
    //	mindate = 1980;
	//	maxdate = 2010;       
	//	plotAccordingToChoices(); 
    //});

    //$("#nineties").click(function () {
	//	mindate = 1990;
	//	maxdate = 2000;
	//	plotAccordingToChoices();        
    //});

    //$("#ninetynine").click(function () {
    //	mindate = 1999;
	//	maxdate = 2000;
	//	plotAccordingToChoices();        
    //});
    
    // insert checkboxes 
    var choiceContainer = $("#{{chart.id}}-choices");
    $.each(datasets, function(key, val) {
        choiceContainer.append(' <li> <input type="checkbox" name="' + key +
                               '" checked="checked" >' + val.label + '</input></li>');
    });
    choiceContainer.find("input").click(plotAccordingToChoices);

    
    function plotAccordingToChoices() {
        var data = [];

        choiceContainer.find("input:checked").each(function () {
            var key = $(this).attr("name");
            if (key && datasets[key])
                data.push(datasets[key]);
        });

        if (data.length > 0)
            $.plot($("#{{chart.id}}-placeholder"), data, {{chart.graph_options|safe}});
    }

    plotAccordingToChoices();
});
</script>

    
