language: python
sudo: required
branches:
  only:
    - master
env:
  matrix:
    - TEST=javascript
    # need node installs for app_manager.XpathValidatorTest
    - TEST=python NOSE_DIVIDED_WE_RUN=05 JS_SETUP=yes
    - TEST=python NOSE_DIVIDED_WE_RUN=6a JS_SETUP=yes
    - TEST=python NOSE_DIVIDED_WE_RUN=bf JS_SETUP=yes
    - TEST=python-sharded
  global:
    - secure: RJDjxqjf/EPPpkY6mRrrNMvElb/hjOPoon0m2wlnS8WL+TWHpaYagX7UEosFzF7+o8pbj5yFzL1ALvPq4kbl+d6wx1rnR6FgqFgPdcJ0zaSBtLzZKJH1aezr4p25dqTWDA9uOpadg0CYqbFxFlfp5VIcx5sXjHVoLiI15Cazl8k=
    - secure: Nnbd5C/9tM7cFfP3uj1XnAkub26A0VjR/5nW6DXrzSU/+EOGTxf/DBqKd3kR5x7qoLdGwmkFtkv3+tzb9BVtqsXwj45inWtUzFVWwjOxp98NTsMUaw/gGjFG+Kos7+DdKy302d/Gqd20NOpVvJdEsDVJQsu7yH9UbdIl7xSrVdE=
before_install:
  # get newer version of docker-compose for variable substitution in compose files
  - curl -L https://github.com/docker/compose/releases/download/1.5.2/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv -v docker-compose /usr/local/bin/
install:
  - mkdir -p $TRAVIS_BUILD_DIR/docker-volumes
  - pip install coverage coveralls
before_script:
  - docker version
  - docker-compose version
script: "scripts/docker test --noinput --stop --verbosity=2 --divide-depth=1"
after_success:
  # create symlink so coverage report can find source files
  - sudo ln -s $(pwd) /mnt/commcare-hq-ro
  - coverage report
  - coveralls
services:
  - docker
