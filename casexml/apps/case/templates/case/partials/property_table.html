{% load i18n %}

<script>
    $(function () {
        $(".property-table-row").on('appear', function () {
            var $rowContainer = $(this),
                maxHeights = [];

            // get max height of each row
            $rowContainer.find("dl").each(function () {
                $(this).children().each(function (i, el) {
                    maxHeights[i] = Math.max(maxHeights[i] || 0, $(el).height());
                });
            });

            // set height on all cells in each row
            _.map(maxHeights, function (val, i) {
                var n = i + 1, 
                    selector = "dd:nth-child(" + n + "), dt:nth-child(" + n + ")";
                $rowContainer.find("dl > " + selector).css({
                    height: val + "px"
                });
            });
        });
    });
</script>

<div class="property-table-row">
    {% for name, columns in tables %}
    <div class="property-table-container">
        {% if name %}
        <div class="table-tab"
            data-target="#case_properties_{{ name|slugify }}">
            {{ name }}
        </div>
        {% endif %}

        <div class="case-properties-table well collapse in" 
            id="case_properties_{{ name|slugify }}">
            {# todo: make work with either tables or dls, specify which with kwarg #}
            {# (requires transforming dl columns to table rows and handling colspan)} #}
            {# <table class="table table-bordered case-properties-table"> #}
            {% for column in columns %}
            <dl>
                {% for expr, name, value in column %}
                <dt title="{{ expr }}">
                    {{ name }}
                </dt>
                <dd>
                    {{ value }}
                </dd>
                {% endfor %}
            </dl>
            {% empty %}
            <dt>
                {% trans "No data" %}
            </dt>
            <dd>
                <span class="muted">
                    {% trans "No properties found for this block." %}
                </span>
            </dd>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>
