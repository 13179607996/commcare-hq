{% load i18n %}
{% load case_tags %}
{% load xform_tags %}

{% include "imports/fancy-code.html" %}

<ul class="nav nav-tabs">
    <li class="active">
        <a href="#form-data" data-toggle="tab">
            {% trans "Form Properties" %}
        </a>
    </li>
    <li>
        <a href="#form-case-data" data-toggle="tab">
            {% trans "Case Changes" %}
        </a>
    </li>
    <li>
        <a href="#form-meta-data" data-toggle="tab">
            {% trans "Form Metadata" %}
        </a>
    </li>
    <li>
        <a href="#form-xml" data-toggle="tab">
            {% trans "Raw XML" %}
        </a>
    </li>
</ul>

<div class="tab-content">
    <div class="tab-pane active" id="form-data">
        <a class="btn pull-right"
            href="{% url render_form_data instance.domain instance.get_id %}">
            {% trans "View Individual Form" %}
        </a>
        {% render_tables form_data form_table_options %}
    </div>

    <div class="tab-pane" id="form-case-data">
        {% if cases %}
        <div class="accordion">
            {% for case_data in cases %}
            <div class="accordion-group">
                <div class="accordion-heading">
                    <span class="accordion-toggle">
                        <a data-toggle="collapse" 
                            href="#form-case-acc-{{ forloop.counter }}">
                            {{ case_data.name }}
                        </a>
                        <span style="float: right">
                            {% if case_data.is_current_case %}
                            <strong class="muted">{% trans "(this case)" %}</strong>
                            {% else %}
                            <a href="{{ case_data.url }}">
                                {% trans "view case" %}
                            </a>
                            {% endif %}
                        </span>
                    </span>
                </div>
                <div class="accordion-body collapse 
                    {% if cases|length == 1 %}in{% endif %}" 
                    id="form-case-acc-{{ forloop.counter }}">
                    <div class="accordion-inner">
                        {% render_tables case_data.table form_table_options %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="muted">This form didn't change any cases.</p>
        {% endif %}
    </div>
    
    <div class="tab-pane" id="form-meta-data">
        {% render_tables form_meta_data form_table_options %}
    </div>

    <div class="tab-pane" id="form-xml">
        <p>
            <a class="btn" href="{% url download_form domain instance.get_id %}" target="_blank">
                {% trans "Open XML in New Window" %}
            </a>
        </p>
        <p>Double-click code below to select all:</p>
        {% render_form_xml instance %}
    </div>
</div>
