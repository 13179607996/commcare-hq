{% load xform_tags %}
<h2>Case Details</h2>
<table class="case_details">
<thead>
    <tr>
        <th>Property</th>
        <th>Value</th>
    </tr>
</thead>
<tbody>
    <tr><td>name</td><td>{{ case.name }}</td></tr>
    <tr><td>opened_on</td><td>{{ case.opened_on }}</td></tr>
    <tr><td>modified_on</td><td>{{ case.modified_on }}</td></tr>
    <tr><td>type</td><td>{{ case.type }}</td></tr>
    <tr><td>closed?</td><td>{{ case.closed|yesno }}</td></tr>
    <tr><td>closed_on</td><td>{{ case.closed_on }}</td></tr>
    <tr><td>domain</td><td>{{ case.domain }}</td></tr>
    <tr><td>external_id</td><td>{{ case.external_id }}</td></tr>
    <tr><td>user_id</td><td>{{ case.user_id }}</td></tr>
    <tr><td>forms</td><td>{% for form_id in case.xform_ids %}
    <p class="xform_ref" data-formid="{{ form_id }}">{% form_inline_display form_id %}</p>
    {% if not forloop.first %}<br>{% endif %}
    {% endfor %}</td></tr>
    <tr>
        <td>Attachments</td><td>
            {% for form_id, filename in case.attachments %}
            {% if not forloop.first %}<br>{% endif %}
            <a href="{% url xform_attachment form_id filename %}">{{ filename }}</a>
            {% endfor %}
        </td>
    </tr>
    
</tbody>
</table>
<h2>Dynamic Properties</h2>
<table class="case_properties">
<thead>
    <tr>
        <th>Property</th>
        <th>Value</th>
    </tr>
</thead>
<tbody>
    {% for prop, val in case.dynamic_case_properties %}
    <tr><td>{{ prop }}</td><td>{{ val }}</td></tr>
    {% empty %}
    <tr><td colspan="2" class="no_data">No data</td></tr>
    {% endfor %}
</tbody>
</table>

<h2>Referrals</h2>
<table class="case_history">
<thead>
    <tr>
        <th>Date Opened</th>
        <th>Type</th>
        <th>Date Modified</th>
        <th>Status</th>
    </tr>
</thead>
<tbody>
{% for referral in case.referrals %}
    <tr>
        <td>{{ referral.opened_on }}</td>
        <td>{{ referral.type }}</td>
        <td>{{ referral.modified_on }}</td>
        <td>{{ referral.closed|yesno:"closed,open" }}</td>
    </tr>
{% empty %}
    <tr><td colspan="4" class="no_data">No referrals</td></tr>
{% endfor %}

</tbody>
</table>

<h2>Case History</h2>
<table class="case_history">
<thead>
    <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Form</th>
    </tr>
</thead>
<tbody>
{% for action in case.actions %}
    <tr><td>{{ action.date }}</td><td>{{ action.action_type }}</td><td>
    {# this makes one call to couch per action, which could be optimized but shouldn't be a big deal since it's small amounts of data #}
    <p class="xform_ref" data-formid="{{ action.xform_id }}">{% form_inline_display action.xform_id %}</p>
    </td></tr>
{% endfor %}
</tbody>
</table>