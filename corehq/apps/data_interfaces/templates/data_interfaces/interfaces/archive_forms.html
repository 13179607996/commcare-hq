{% extends 'reports/async/tabular.html' %}
{% load hq_shared_tags %}
{% load report_tags %}
{% load i18n %}

{% block js-inline %} {{ block.super }}
    <script type="text/javascript">
    (function () {

        function applyCheckboxBindings() {
            var $XFormManagement = $('#form-management');

            $XFormManagement.find('a.select-all').click(function () {
                $XFormManagement.find('input.xform-checkbox').attr('checked', true).change();
                return false;
            });

            $XFormManagement.find('a.select-none').click(function() {selectNone(); return false;});
            $XFormManagement.find('.dataTables_paginate a').mouseup(selectNone);
            $XFormManagement.find('.dataTables_length select').change(selectNone);

            function selectNone() {
                $XFormManagement.find('input.xform-checkbox:checked').attr('checked', false).change();
            }
        }

        var keepTrying = setInterval(function () {
            if (window.reportTables !== undefined) {
                clearInterval(keepTrying);
                applyCheckboxBindings();
                window.reportTables.fnDrawCallback = applyCheckboxListeners;
            }
        }, 1000);
    }());
    </script>
{% endblock %}

{% block reportcontent %}
    <div id="form-management">
        <p class="alert fade in hide page-level-alert alert-error" id="errorMessage">
            {% blocktrans %}
                Something went wrong! There was an error. If you see this error repeatedly please report it as issue.
            {% endblocktrans %}
            </span>
        </p>
        <form class="well form-inline"
              method="post"
              action="{% url 'xform_management' domain %}"
              enctype="multipart/form-data">
            <div class="row-fluid">
                <div>{% trans 'Selected Forms' %}</div>
                <label for="select_all">{% trans 'Select all Forms' %}</label>
                <input type="checkbox" name="select_all" value="{{ filters_as_es_query|escape }}">
                <input type="hidden" name="mode" value="{{ archive_or_restore }}">
                <button>{{ button_text }}</button>
            </div>
            {{ block.super }}
        </form>
    </div>
{% endblock %}
