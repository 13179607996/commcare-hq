{% extends 'reports/generic_report.html' %}
{% load hq_shared_tags %}
{% load report_tags %}
{% load i18n %}

{% block js %} {{ block.super }}
    <script src="{% static 'case/js/cheapxml.js' %}"></script>
    <script type="text/javascript" src="{% static 'case/js/casexml.js' %}"></script>
    <script type="text/javascript" src="{% static 'data_interfaces/ko/case_management.js' %}"></script>
{% endblock %}

{% block js-inline %} {{ block.super }}
<script type="text/javascript">
    ko.applyBindings(new CaseManagement( {
        owners: {{ available_owners|JSON }},
        receiverUrl: '{% url receiver_post domain %}',
        enddate: '{{ request.datespan.enddate_param }}',
        webUserID: '{{ request.couch_user.userID }}'
    } ), $('#case-management')[0]);

    $(function () {
        $('#case-management a.select-all').click(function () {
            $('#case-management input.selected-commcare-case').attr('checked', true).change();
            return false;
        });

        $('#case-management a.select-none').click(function() {selectNone(); return false;});
        $('#case-management .dataTables_paginate a').mouseup(selectNone);

        function selectNone() {
            $('#case-management input.selected-commcare-case:checked').attr('checked', false).change();
        }

    });
</script>
{% endblock %}

{% block reportcontent %}
    {{ request.user.userID }}
<div id="case-management">
    <div class="row-fluid">
        <form class="well form-inline" style="margin: 1em; display: none;" data-bind="submit: updateCaseOwners, caseReassignmentForm: selected_cases">
            <label for="reassign_user_select">Reassign selected cases to:</label>
            <select name="reassign_user" id="reassign_user_select" data-bind="caseReassignmentOwners: selected_owners, options: available_owners, optionsText: 'username', optionsValue: 'userid', optionsCaption: 'Select New Owner...'"></select>
            <button type="submit" class="btn btn-primary">Reassign</button>
        </form>
    </div>
    {{ block.super }}
</div>
{% endblock %}

{% block modals %} {{ block.super }}
    <div class="modal hide fade" id="caseManagementStatusModal">
        <div class="modal-header">
            <a class="close" data-dismiss="modal">&times;</a>
            <h3>Case Reassignment</h3>
        </div>
        <div class="modal-body">
            --
        </div>
        <div class="modal-footer">
            <button id="bug-report-cancel" class="btn" data-dismiss="modal">Close</button>
        </div>
    </div>
{% endblock %}