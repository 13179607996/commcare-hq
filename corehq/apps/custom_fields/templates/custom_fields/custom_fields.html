{% extends 'settings/base_template.html' %}
{% load crispy_forms_tags %}
{% load hq_shared_tags %}
{% load hqstyle_tags %}
{% load i18n %}

{% block js %}
{{ block.super }}
    <script type="text/javascript" src="{% static 'hqwebapp/js/lib/jquery-ui/jquery-ui-1.8.16.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'hqwebapp/js/knockout-bindings.js' %}"></script>
    <script type="text/javascript" src="{% static 'custom_fields/js/custom_fields.js' %}"></script>
{% endblock %}

{% block js-inline %}
{{ block.super }}
    <script>
        var customFieldsModel = new CustomFieldsModel();
        ko.applyBindings(customFieldsModel, $('#custom-fields-form').get(0));
        customFieldsModel.init({{ custom_fields|JSON }});
    </script>
{% endblock %}

{% block main_column %}
    {# {% crispy custom_fields_form %} #}
    <form id="custom-fields-form" action="." method="POST" data-bind="submit: submitFields">
        {% csrf_token %}
        <table class="table table-striped">
            <caption><h3>{{ view.page_name }}</h3></caption>
            <thead>
                <tr>
                    <th></th>
                    <th>{% trans "Key" %}</th>
                    <th>{% trans "Field Label" %}</th>
                    <th>{% trans "Required" %}</th>
                    <th>{% trans "Delete" %}</th>
                </tr>
            </thead>
            <tbody data-bind="sortable: data_fields">
                <tr>
                    <td class="sortable-handle">
                        <i class="icon-resize-vertical"></i>
                    </td>
                    <td>
                        <input type="text" data-bind="value: slug"/>
                    </td>
                    <td>
                        <input type="text" data-bind="value: label"/>
                    </td>
                    <td>
                        <input type="checkbox" data-bind="checked: is_required"/>
                    </td>
                    <td>
                        <button type="button" class="close" data-bind="click: $root.removeField">&times;</button>
                    </td>
                </tr>
            </tbody>
            <tr><td></td><td></td><td></td><td>
                <button class="pull-right" data-bind="click: addField">Add a Field</button>
            </td></tr>
        </table>

        <p><input id="save-custom-fields" class="pull-right btn btn-primary" type="submit" value="Save Fields"></p>
    </form>
{% endblock %}
