{% load hq_shared_tags %}
{% load hqstyle_tags %}
{% load i18n %}

<table id="table-form" class="table table-striped table-bordered">

    <thead>
        <tr>
            {% for header in headers %}
                <th>{{ header }}</th>
            {% endfor %}
        </tr>
    </thead>

    <tbody data-bind="foreach: rows">
        <tr>
            {% for spec in row_spec %}
            <td>
                {% if spec.type == "RAW" %}
                    <span data-bind="text: get_value('{{ spec.key }}')"></span>
                {% elif spec.type == "TextInput" %}
                <input name="{{ spec.key }}"
                       data-bind="value: get_value('{{ spec.key }}')">
                {% else %}
                    <span class="error">{{ spec.type }} NOT FOUND</span>
                {% endif %}
            </td>
            {% endfor %}
        </tr>
    </tbody>

</table>

<script type="text/javascript" src="{% static 'style/ko/knockout_bindings.ko.js' %}"></script>
<script>
$(document).ready(function() {
    function Row(data) {
        var self = this;
        self.data = data;

        self.get_value = function(key) {
            return self.data[key];
        };
    }

    function TableModel(row_spec, raw_rows) {
        var self = this;
        self.row_spec = row_spec;
        self.rows = ko.observableArray();

        for (var i = 0; i < raw_rows.length; i++) {
            self.rows.push(new Row(raw_rows[i]));
        }
    }

    var tableModel = new TableModel({{ row_spec|JSON }}, {{ rows|JSON }});
    ko.applyBindings(tableModel, $('#table-form').get(0));
});
</script>
