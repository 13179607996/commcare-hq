{% extends "hqwebapp/base_section.html" %}
{% load hq_shared_tags %}
{% load i18n %}
{% load compress %}

{% block stylesheets %}{{ block.super }}
    {% compress css %}
        <link type="text/css" rel="stylesheet" media="all" href="{% static 'leaflet/dist/leaflet.css' %}" />
        <link rel="stylesheet" href="{% static 'reports/css/maps.css' %}" />
    {% endcompress %}
{% endblock stylesheets %}

{% block js %}{{ block.super }}
    <script src="{% static 'reports/js/config.dataTables.bootstrap.js' %}"></script>
    <script src="{% static 'reports_core/js/choice-list-api.js' %}"></script>
    <script src="{% static 'reports_core/js/charts.js' %}"></script>
    <script src="{% static 'reports_core/js/maps.js' %}"></script>
    <script src="{% static 'leaflet/dist/leaflet.js' %}"></script>
    <script src="{% static 'reports/js/maps_utils.js' %}"></script>
    <script src="{% static 'userreports/js/report_analytix.js' %}"></script>
            <script src="{% static 'reports_core/js/base_template_new.js' %}"></script>
{% endblock %}

{% block head %}{{ block.super }}
    <style>
        #map-container {
            height: 500px;
        }
    </style>
{% endblock %}


{% block title %}{{ report.title|default:"Project Reports"|safe }}{% endblock %}

{% block page_title %}{% endblock %}

{% block page_content %}
{% initial_page_data ' endfor'  endfor %}
{% initial_page_data ' endif'  endif %}
{% initial_page_data ' include filter.javascript_template with filter=filter context_=filter_context|dict_lookup:filter.css_id'  include filter.javascript_template with filter=filter context_=filter_context|dict_lookup:filter.css_id %}
{% initial_page_data ' if filter.javascript_template'  if filter.javascript_template %}
{% initial_page_data ' for filter in report.filters'  for filter in report.filters %}
{% initial_page_data ' endif'  endif %}
{% initial_page_data ' report_table.left_col.fixed.width'  report_table.left_col.fixed.width %}
{% initial_page_data ' report_table.left_col.fixed.num'  report_table.left_col.fixed.num %}
{% initial_page_data ' if report_table.left_col.is_fixed'  if report_table.left_col.is_fixed %}
{% initial_page_data ' method'  method %}
{% initial_page_data ' url'  url %}
{% initial_page_data ' endif'  endif %}
{% initial_page_data ' headers.auto_width|JSON'  headers.auto_width|JSON %}
{% initial_page_data ' endif'  endif %}
{% initial_page_data ' report_table.show_all_rows|JSON'  report_table.show_all_rows|JSON %}
{% initial_page_data ' report_table.start_at_row|default:0'  report_table.start_at_row|default:0 %}
{% initial_page_data ' report_table.default_rows|default:10'  report_table.default_rows|default:10 %}
{% initial_page_data ' report.slug'  report.slug %}
{% initial_page_data ' MAPBOX_ACCESS_TOKEN'  MAPBOX_ACCESS_TOKEN %}
{% initial_page_data ' report.spec.map_config|JSON'  report.spec.map_config|JSON %}
{% initial_page_data ' report.spec.report_meta.created_by_builder|JSON'  report.spec.report_meta.created_by_builder|JSON %}
{% initial_page_data ' report.spec.charts|JSON'  report.spec.charts|JSON %}
{% initial_page_data ' url'  url %}
    {% block report_alerts %}
    <div id="report-error" class="alert alert-danger hide">
        {% blocktrans %}
        There was an error rendering your report.
        {% endblocktrans %}
        <div id="error-message"></div>
    </div>
    <div id="report-warning" class="alert alert-warning hide">
        {% blocktrans %}
        Warning:
        {% endblocktrans %}
        <div id="warning-message"></div>
    </div>
    {% endblock report_alerts %}
    {% block main_column_content %}
    {% block filter_panel %}
        {% include "reports_core/partials/filter_panel.html" %}
    {% endblock %}

    <hr />
    <div id="reportHint" class="alert alert-info">
        <h4><i class="fa fa-info-circle"></i> {% blocktrans %}Why can't I see any data?{% endblocktrans %}</h4>
        <p>{% blocktrans %}Please choose your filters above and click <strong>Apply</strong> to see report data.{% endblocktrans %}</p>
    </div>
    <div id="reportContent" class="hide">
        {% block reportcharts %}
        <section id="chart-container" style="display: none;">
        </section>
        <section id="chart-warning" class="alert alert-warning hide">
        {% blocktrans %}
            Charts cannot be displayed with more than 25 categories. Please filter the data or change your report to limit the number of rows.
        {% endblocktrans %}
        </section>
        <section id="map-container" style="display: none;" >
        </section>
        <div id="zoomtofit" class="leaflet-control-layers" style="display: none;">
            <div id="zoomtofit-target" class="zoomtofit leaflet-control-layers-toggle" title="{% trans "Fit all data into view" %}"></div>
        </div>

        <div id="report-info" class="alert alert-info hide">
            {% blocktrans %}
            Note:
            {% endblocktrans %}
            <span id="info-message"></span>
        </div>
        {% endblock %}
        {% block reporttable %}
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>{{ report.title }}</h4>
            </div>
            <div class="panel-body hq-datatable-container">
                <table id="report_table_{{ report.slug }}" class="table table-striped">
                    <thead>
                    {{ headers.render_html|safe }}
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
        {% endblock reporttable %}
    </div>

    {% endblock main_column_content %}
{% endblock %}
