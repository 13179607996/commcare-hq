{% extends "users/users_base.html" %}
{% load i18n %}
{% load hq_shared_tags %}

{% block js %}{{ block.super }}
    <script src="{% static 'users/js/key_filters.js' %}"></script>
    <script src="{% static 'locations/ko/location_tree.async.js' %}"></script>
{% endblock %}

{% block js-inline %}{{ block.super }}
    <script type="text/javascript">

var LOAD_LOCS_URL = '{{ api_root }}';

$(function() {

  var model = new LocationTreeViewModel();
  ko.applyBindings(model, $('#location_tree')[0]);
  model.load();

});

    </script>
{% endblock %}

{% block subsection-title %}
    <li class="active">
        <a href="#">Locations</a>
    </li>
{% endblock %}

{% block user-view %}
<header>
    <div class="row-fluid">
        <div class="span8">
            <h2>Manage Locations</h2>
        </div>
    </div>
</header>
<div>

    <div class="row-fluid">
        <div class="span12">
            <div class="btn-toolbar">
                <a class="btn" href="{% url upload_commcare_users domain %}">Bulk Import</a>
                <a class="btn" href="{% url upload_commcare_users domain %}">Bulk Export</a>
            </div>
        </div>
    </div>

    <script type="text/html" id="location-template">
      <div data-bind="if: name() != '_root'">
        <span data-bind="if: can_have_children"><a data-bind="click: toggle, text: (expanded() ? '[-]' : '[+]')"></a></span>
        <span data-bind="text: name"></span> (<span data-bind="text: type"></span>)
        <a class="btn btn-primary" href="#">Edit</a>
      </div>
      <div data-bind="visible: children_status() == 'loading'">
        <img src="{% static 'hqwebapp/img/ajax-loader.gif' %}" alt="loading indicator" /> Loading&hellip;
      </div>
      <div data-bind="if: expanded">
        <ul data-bind="foreach: children">
          <li data-bind="template: { name: 'location-template' }"></li>
        </ul>
        <a class="btn btn-success" href="#"><i class="icon icon-white icon-plus"></i> New location <span data-bind="text: (name() == '_root' ? 'at top level' : 'in ' + name())"></span></a>
      </div>
    </script>

    <div id="location_tree">
      <div data-bind="template: { name: 'location-template', if: root, data: root }"></div>
    </div>

</div>
{% endblock %}

{% block modals %}{{ block.super }}
    
{% endblock %}
