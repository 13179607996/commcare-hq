{% extends "users/users_base.html" %}
{% load i18n %}
{% block user-view %}
    <h3>My CommCare Accounts</h3>
<div class='all_users'>
	<h4>CommCare users associated with you ({{ couch_user.django_user.username }})</h4>
    {% if commcare_users %}
        <table class='big_border'>
            <tr><td></td>
                <td>{% trans "Username" %}</td>
                <td>{% trans "Domain" %}</td>
                <td>{% trans "Registering Phone ID" %}</td>
                <td>{% trans "Unlink From User" %}</td>
            </tr>
            {% for commcare_user in commcare_users %}
                <tr><td></td>
                    <td>{{ commcare_user.django_user.username }}</a></td>
                    <td>{{ commcare_user.domain }}</td>
                    <td>{{ commcare_user.registering_phone_id }}</td>
                    <td><a class="delete_link" href="#">>{% trans "Unlink" %}</a>
                        <div class="delete_dialog" title="Unlink {{ commcare_user.django_user.username }}?">
                            <form name="unlink_commcare_account" action="{% url unlink_commcare_account commcare_user.domain couch_user.couch_id forloop.counter0 %}" method="POST">
                                <table>
                                    <tr><td>
                                    Are you sure you want to unlink commcare user {{commcare_user.django_user.username}} from user "{{ couch_user.get_id }}"?
                                    </td></tr>
                                </table>
                                <input type="submit" value="Unlink" />
                            </form>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </table>
    {% else %}
        <p class="big_border">You have no CommCare accounts.</p>
    {% endif %}

	<h4>All CommCare users in domain "{{ domain }}"</h4>
    {% if other_commcare_users %}
        <table class='big_border'>
            <tr><td></td>
                <td>{% trans "Web User" %}</td>
                <td>{% trans "Username" %}</td>
                <!--td>{% trans "Domain" %}</td-->
                <td>{% trans "Registering Phone ID" %}</td>
                <td>{% trans "Link To User" %}</td>
            </tr>
            {% for commcare_user in other_commcare_users %}
                <tr><td></td>
                <td>
                    {% if commcare_user.couch_user_username %}
                    {{ commcare_user.couch_user_username }}
                    {% else %}
                    <!--  {{ commcare_user.get_id }}  -->
                    n/a
                    {% endif %}
                </td>
                <td>{{ commcare_user.django_user.username }}</a></td>
                <!--td>{{ commcare_user.domain }}</td-->
                <td>{{ commcare_user.registering_phone_id }}</td>
                <td><a class="add_link" href="#"></a>
                    <div class="add_dialog" title="Add {{ commcare_user.django_user.username }}?">
                        <form name="link_commcare_account" action="{% url link_commcare_account_to_user commcare_user.domain couch_user.couch_id commcare_user.django_user.username %}" method="POST">
                            <table>
                                <tr><td>
                                Are you sure you want to associate user {{ couch_user.get_id }} with the commcare account "{{ commcare_user.django_user.username }}"?
                                </td></tr>
                            </table>
                            <input type="submit" value="Link" />
                            <input type="hidden" name="commcare_couch_user_id" value="{{ commcare_user.couch_user_id }}" />
                        </form>
                    </div>
                </td>
                </tr>
            {% endfor %}
        {% else %}
        <p class="big_border">There are no other users in this domain.</p>
        {% endif %}
	</table>
	<a href="{% url add_commcare_account domain %}">Add New CommCare Account</a>
</div>
{% endblock %}

