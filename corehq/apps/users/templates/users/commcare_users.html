{% extends "users/users_base.html" %}
{% load i18n %}
{% load hq_shared_tags %}

{% block js %}{{ block.super }}
    <script src="{% static 'users/js/key_filters.js' %}"></script>
    <script src="{% static 'users/js/commcare_users.async.js' %}"></script>
{% endblock %}

{% block js-inline %}{{ block.super }}
    <script type="text/javascript">
        $(function(){
            var help_text = {
                "Archive User": "Archive a user if they are no longer active, and they will stop appearing in reports to reduce clutter. " +
                        "Archiving is completely reversible, so you can always reactivate them later.",
                "Delete User": "Deleting a user removes any record of them, including all of the forms they ever submitted and their " +
                        "associated cases. We recommend only deleting users that never corresponded to real people to begin with, " +
                        "such as users created while testing an application.<br /><br />If you are unsure, it is safer to <strong>archive</strong> a user.",
                "Case Sharing": "You have selected to use case sharing in your apps. To use basic case sharing, " +
                        "a user must belong to exactly one case sharing group."
            };

            $('.help_popover').popover({
                placement: $(this).data('placement') || 'left',
                title: function () {
                    return $(this).attr('data-help-key');
                },
                content: function () {
                    return help_text[$(this).attr('data-help-key')];
                }
            });
        });
        var async_handler = new CommCareUsersListHandler({
            total: {{ users_list.total }},
            page: {{ users_list.page }},
            limit: {{ users_list.limit }},
            cannot_share: {{ cannot_share|yesno:"true,false" }},
            show_inactive: {{ show_inactive|yesno:"true,false" }},
            list_url: '{% url user_list domain %}',
            list_elem: '#commcare-users-list'
        });
        async_handler.init();
    </script>
{% endblock %}

{% block subsection-title %}
    <li class="active">
        <a href="#">{% commcare_user %}s</a>
    </li>
{% endblock %}

{% block user-view %}
    <div class="row-fluid">
        <div class="span12">
            <h2>
                Manage {% commcare_user %}s
                {% if cannot_share %}<small>without the correct number of groups</small>{% endif %}
                {% if show_inactive %}<small>Showing Inactive Mobile Workers</small>{% endif %}
            </h2>
            <p style="max-width: 800px;">
                {% if cannot_share %}
                    {% commcare_user %}s that have more or less than one group cannot use forms in applications with case sharing turned on. To allow them to use applications with case sharing turned on, please assign them one (and no more than one) group.
                {% else %}
                    {% commcare_user %}s can submit forms from phones running the CommCare Application. While {% commcare_user %}s can login to CommCare HQ and view project data,
                    they are bound to a particular project on CommCare HQ and cannot manage the project or create additional projects and users.
                {% endif %}
            </p>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <div class="btn-toolbar">
                {% if not show_inactive %}
                    <a class="btn btn-primary pull-right" href="./?show_inactive=true">Show Archived {% commcare_user %}s</a>
                {% endif %}
                <a class="btn btn-success" href="{% url add_commcare_account domain %}"><i class="icon icon-white icon-plus"></i> New {% commcare_user %}</a>
                or
                <a class="btn" href="{% url upload_commcare_users domain %}">Bulk Upload</a>
            </div>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span12" id="commcare-users-list">
            Loading...
        </div>
    </div>
{% endblock %}