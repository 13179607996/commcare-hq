{% extends "reports/base_template.html" %}
{% load hq_shared_tags %}

{% block js %}
<script src="{% static 'hqwebapp/js/jquery.multi_typeahead.js' %}"></script>

{% endblock %}

{% block js-inline %}
<script>
$(function() {
   $("#hour-input").val("9");

   $("#recipient_emails").multiTypeahead({
       source: {{ user_emails|JSON }}
   });
});
</script>
{% endblock %}

{% block main_column %}
    <div class="row-fluid">
        <div class="span12">
            <h2>Create a new scheduled report</h2>
            {% if configs %}
            <form class="form form-horizontal" method="post" action="">
                <fieldset>
                    <div class="control-group">
                        <label class="control-label" for="config_id">Saved report(s)</label>
                        <div class="controls">
                            <select name="config_id" id="config_id" class="input input-fancy-multi" multiple="multiple">
                                {% for config in configs %}
                                <option value="{{ config.get_id }}">
                                    {{ config.full_name }}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="help alert alert-info" style="margin-top: 1em; width: 400px;">
                                <p>You can use Ctrl-Click to select multiple saved reports to include.</p>
                                <p><strong>Note:</strong> Not all built-in reports currently support email delivery, so some of your saved reports may not appear in this list.</p>
                            </div>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="day-input">Day </label>
                        <div class="controls">
                            <select name="day" id="day-input">
                                <optgroup label="Daily">
                                    <option value="all">Every Day</option>
                                </optgroup>
                                <optgroup label="Once a week on...">
                                    {% for day, display in days %}
                                    <option value="{{day}}">{{display}}</option>
                                    {% endfor %}
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="hour-input">Time </label>
                        <div class="controls">
                            <select name="hour" id="hour-input">
                                {% for hr, display in hours %}
                                <option value="{{hr}}">{{display}}</option>
                                {% endfor %}
                            </select>

                            <div class="help-inline alert alert-info" style="width: 400px;">
                                Sorry, at the moment all times are in GMT.
                            </div>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="controls">
                            <label class="checkbox" for="send_to_owner">
                                <input type="checkbox" name="send_to_owner" id="send_to_owner" checked="checked">Send to me
                            </label>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="recipient_emails">Other recipients</label>
                        <div class="controls">
                            <textarea name="recipient_emails" id="recipient_emails"></textarea>
                        </div>
                    </div>
                </fieldset>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </form>
            {% else %}
            <div class="alert">
                You need a saved report that supports email in order to set up a scheduled email report, but you don't have any.
            </div>
            <div class="alert alert-info">
                <strong>Note:</strong> Not all built-in reports currently support email delivery.
            </div>
            {% endif %}
        </div>
    </div>
{% endblock %}
