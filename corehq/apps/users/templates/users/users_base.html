{% extends "hqwebapp/two_column.html" %}
{% load hq_shared_tags %}

{% block page_imports %}
    <link rel="stylesheet" href="{{ STATIC_URL }}users/css/users.css?version=1" />
{% endblock %}
{% block js %}{{ block.super }}
{#    <script src="{% static 'users/js/users.js' %}"></script>#}
{% endblock %}
{% block js-inline %}{{ block.super }}
    <script type="text/javascript">
        $(function () {
            $('#users-main-nav li a').each(function(e) {
                if ($(this).attr('href') == '{{ request.path }}')
                    $(this).parent().addClass('active');
            });
            var activeTabCookie = 'active_tab',
                last_active_tab = $.cookie(activeTabCookie);
            if(last_active_tab) {
                $(last_active_tab).addClass('active');
                $('#project-settings-tabs a[href="'+last_active_tab+'"]').parent().addClass('active');
            } else {
                var first_tab = $('#project-settings-tabs a[data-toggle="tab"]').first();
                first_tab.parent().addClass('active');
                $(first_tab.attr('href')).addClass('active');
            }
            $('#project-settings-tabs a[data-toggle="tab"]').on('shown', function (e) {
                $.cookie(activeTabCookie, $(this).attr('href'),
                        {path: '{{ request.path }}',
                        expires: 1});
            });
        });
    </script>
{% endblock %}

{% block page-title %}
    <ul class="breadcrumb">
        <li>
            <a href="{% url users_default domain %}"><strong>Project Settings</strong></a>
        </li>
    </ul>
{% endblock %}

{% block sidebar %}
<nav>
    <ul class="nav nav-list" id="users-main-nav">
        <li class="nav-header">My Account</li>
        <li><a href="{% url user_account domain request.couch_user.user_id %}">Account Settings</a>
            {% block account_indicator %}{% endblock %}
        </li>
        <li><a href="{% url change_my_password domain %}">Change Password</a></li>
    {% if request.couch_user.can_edit_web_users or request.couch_user.can_edit_commcare_users %}
        <li class="nav-header">User Management</li>
        {% if request.couch_user.can_edit_web_users %}
            <li><a href="{% url web_users domain %}">Web Users</a>
                {% block web_users_indicator %}{% endblock %}
            </li>
        {% endif %}
        {% if request.couch_user.can_edit_commcare_users %}
            <li><a href="{% url commcare_users domain %}">CommCare Users</a>
                {% block commcare_users_indicator %}{% endblock %}
            </li>
            <li><a href="{% url all_groups domain %}">Groups</a>
                {% block groups_indicator %}{% endblock %}
            </li>
        {% endif %}
    {% endif %}
    {% if request.couch_user.is_domain_admin %}
        <li class="nav-header">Project Administration</li>
        <li><a href="{% url domain_global_settings domain %}">Global Settings</a></li>
    {% endif %}
    </ul>
</nav>
{% endblock %}
{% block main_column %}
<article id="user-view">
    {% block user-view %}
        <p class="message">Click on the menu to the left to edit your settings.</p>
    {% endblock %}
    {% if error %}
        <div id="error_msg">
            {{ error }}
        </div>
    {% endif %}
</article>
{% endblock %}