{% extends 'hqwebapp/base_section.html' %}
{% load i18n %}
{% load hq_shared_tags %}

{% block js %} {{ block.super }}
    <script type="text/javascript" src="{% static 'hqwebapp/js-custom/hq.legacy.js' %}"></script>
{% endblock %}

{% block js-inline %} {{ block.super }}
    {# todo cleanup #}
    <script type="text/javascript">
        $(function () {
            var path = '{{ request.path }}';
            COMMCAREHQ.initBlock($('.hq-content'));
            $('#users-main-nav li a').each(function(e) {
                if ($(this).attr('href') == path) {
                    $(this).parent().addClass('active');
                }
            });
            $('.hq-help-template').each(function () {
                COMMCAREHQ.makeHqHelp({
                    content: $(this).data('content'),
                    title: $(this).data('title')
                }, false).insertAfter(this);
                $(this).remove();
            });
            $('.hq-help').hqHelp();
            var activeTabCookie = 'active_tab',
                last_active_tab = $.cookie(activeTabCookie);
            if(last_active_tab) {
                $(last_active_tab).addClass('active');
                $('#project-settings-tabs a[href="'+last_active_tab+'"]').parent().addClass('active');
            } else {
                var first_tab = $('#project-settings-tabs a[data-toggle="tab"]').first();
                first_tab.parent().addClass('active');
                $(first_tab.attr('href')).addClass('active');
            }
            $('#project-settings-tabs a[data-toggle="tab"]').on('shown', function (e) {
                $.cookie(activeTabCookie, $(this).attr('href'),
                        {path: '{{ request.path }}',
                        expires: 1});
            });
        });
    </script>
{% endblock %}
