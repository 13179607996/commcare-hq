{% load i18n %}

<div class='all_users'>
	<h4>CommCare users associated with {{ couch_user.web_account.username_html|safe }}</h4>
    {% if couch_user.commcare_accounts %}
        <table class='big_border'>
            <tr><th></th>
                <th>{% trans "Username" %}</th>
                <th>{% trans "Domain" %}</th>
                <th>{% trans "Registering Phone ID" %}</th>
                <th>{% trans "Unlink From User" %}</th>
            </tr>
            {% for account in couch_user.commcare_accounts %}
                <tr><td></td>
                    <td>{{ account.username_html|safe }}</td>
                    <td>{{ account.domain }}</td>
                    <td>{{ account.registering_device_id }}</td>
                    <td><a class="delete_link" href="commcare_accounts.html#">{% trans "Unlink" %}</a>
                        <div class="dialog delete_dialog" title="Unlink {{ account.username_html|safe }}?">
                            <form name="unlink_commcare_account" action="{% url unlink_commcare_account account.domain couch_user.couch_id forloop.counter0 %}" method="POST">
                                <table>
                                    <tr><td>
                                    Are you sure you want to unlink commcare user {{account.login.username}} from user "{{ couch_user.get_id }}"?
                                    </td></tr>
                                </table>
                                <input type="submit" value="Unlink" />
                            </form>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </table>
    {% else %}
        <p class="big_border">There are no CommCare accounts associated with {{ couch_user.web_account.username_html|safe }}.</p>
    {% endif %}

    {% if request.couch_user.is_domain_admin or request.user.is_superuser %}
        <h4>Other CommCare users in domain "{{ domain }}"</h4>
        <table class='big_border'>
            {% if other_commcare_accounts %}
                <tr><th></th>
                    <th>{% trans "Web User" %}</th>
                    <th>{% trans "Username" %}</th>
                    <!--th>{% trans "Domain" %}</th-->
                    <th>{% trans "Registering Phone ID" %}</th>
                    <th>{% trans "Link To User" %}</th>
                </tr>
                {% for user, account in other_commcare_accounts %}
                    <tr><td></td>
                    <td>
                        {% if user.web_account.login %}
                            {{ user.web_account.username_html|safe }}
                        {% else %}
                            n/a
                        {% endif %}
                    </td>
                    <td>{{ account.username_html|safe }}</a></td>
                    <!--td>{{ account.domain }}</td-->
                    <td>{{ account.registering_device_id }}</td>
                    <td>
                        <a class="new_link dialog_opener" href="#">Add</a>
                        <div class="dialog" title="Add {{ account.username_html|safe }}?">
                            <form name="link_commcare_account" action="{% url link_commcare_account_to_user account.domain couch_user.couch_id account.login_id %}" method="POST">
                                <table>
                                    <tr><td>
                                    Are you sure you want to associate user {{ couch_user.get_id }} with the commcare account "{{ account.username_html|safe }}"?
                                    </td></tr>
                                </table>
                                <input type="submit" value="Link" />
                                <input type="hidden" name="commcare_couch_user_id" value="{{ user.get_id }}" />
                            </form>
                        </div>
                    </td>
                    </tr>
                {% endfor %}
            {% else %}
            <p class="big_border">There are no other CommCare accounts in this domain.</p>
            {% endif %}
        </table>
        <a class="new_link" href="{% url add_commcare_account domain %}">CommCare Account</a>
    {% endif %}
</div>
