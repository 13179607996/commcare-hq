{% extends "users/users_base.html" %}
{% load i18n %}
{% block js-inline %}
    <script>
        $(function () {
            function selectText(element) {
                /* copied from http://stackoverflow.com/questions/985272/jquery-selecting-text-in-an-element-akin-to-highlighting-with-your-mouse */
                var doc = document;
                var text = element[0];

                if (doc.body.createTextRange) { // ms
                    var range = doc.body.createTextRange();
                    range.moveToElementText(text);
                    range.select();
                } else if (window.getSelection) { // moz, opera, webkit
                    var selection = window.getSelection();
                    var range = doc.createRange();
                    range.selectNodeContents(text);
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
            }
            $('#show_all_web_users_emails').click(function () {
                var open = false,
                    p = $('#all_web_users_emails');
                p.toggle();
                open = !open;
                if (open) {
                    selectText(p);
                }
                return false;
            });
        });
    </script>
{% endblock %}
{% block user-view %}
    <h1>Web Users</h1>
	<table class='big_border'>
	<tr><th></th>
		<th>{% trans "E-mail" %}</th>
		<th>{% trans "Role" %}</th>
        <th>{% trans "Name" %}</th>
		<th>{% trans "Phone Numbers" %}</th>
        <th>{% trans "Remove" %}</th>
	</tr>
	{% for user in web_users %}
	<tr><td></td>
		<td>
            <a href="{% url user_account domain user.couch_id %}">
                {{ user.html_username|safe }}
            </a>
        </td>
		<td>{{ user.role_label }}</td>
		<td>{{ user.first_name }} {{ user.last_name }}</td>
		<td>
			{% if user.phone_numbers %}
				+{{ user.default_phone_number }}
				{% if user.phone_numbers.1 %}
					(and more)
				{% endif %}
			{% else %}{% endif %}
		</td>
        <td>
            <form action="{% url remove_web_user domain user.user_id %}">
                <a href="#" class="submit"><div class="ui-icon ui-icon-closethick"></div></a>
            </form>
        </td>
	</tr>
	{% endfor %}
	</table>
    {% if user.is_superuser %}
        <a id="show_all_web_users_emails" href="#">Copy and paste admin emails</a>
        <p id="all_web_users_emails" class="hidden">
            {% for user in web_users %}
                {% if user.is_domain_admin %}
                {% if user.first_name or user.last_name %}
                    "{{ user.first_name }} {{ user.last_name }}"
                    &lt;{{ user.username }}&gt;,
                {% else %}
                    {{ user.username }},
                {% endif %}
                {% endif %}
            {% endfor %}
        </p>
    {% endif %}
    <div>
        <a class="new_link" href="{% url invite_web_user domain %}">Web User</a>
    </div>
{% endblock %}

