{% extends base_template %}
{% block head %}{{ block.super }}
    <link rel="stylesheet" href="{{ STATIC_URL }}hqmedia/css/media_upload.css" />
{% endblock %}
{% block js %}{{ block.super }}
<script type="text/javascript" src="{{ STATIC_URL }}hqmedia/js/jquery.form.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}hqmedia/js/jquery.progressbar.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}hqmedia/js/hqmedia_upload.js"></script>
<script type="text/javascript">
    $().ready(function() {
        var _failed_files = $("#failed_files");
        function showFailedFiles () {
           $.getJSON("{{ failed_files_url }}", function(data) {
               if (data.failed_files) {
                   _failed_files.prepend("<h3>We could not find references to the following files in your application:</h3>");
                   _failed_files.fadeIn();
               }
               for (var i = 0; i < data.failed_files.length; i++) {
                   $("#failed_files ul").append("<li>"+data.failed_files[i]+"</li>");

               }
           });
        }

        var hqUpload;
        hqUpload = new HQMediaUpload({
            progress_id_varname: '{{ progress_id_varname }}',
            submit_url: '{{ submit_url }}',
            progress_checker_url: '{{ upload_progress_url }}',
            processbar: '#hqmedia_processing_progressbar',
            static_url: '{{ STATIC_URL }}',
            submit_complete: function() {
                showFailedFiles();
            }
        });

        _failed_files.fadeOut();
        hqUpload.listenForUploads();
    });
</script>
{% endblock %}

{% block content %}
<div id="main_container">
    <div class="padded">
        <h1>Upload a .Zip file</h1>
        <div class="body">
            <form action="" id="hqmedia_upload" method="post" enctype="multipart/form-data">
                <ul>
                {% for field in zipform %}
                    {% if field.field.required %}
                    <li>{{ field.label_tag }}: {{ field }} <span class="helptext">{{ field.help_text }}</span></li>
                    <li class="error" id="errors_{{ field.name }}">{{ field.errors }}</li>
                    {% endif %}
                {% endfor %}
                </ul>
                <ul class="advanced-options">
                {% for field in zipform %}
                    {% if not field.field.required %}
                    <li>{{ field.label_tag }}: {{ field }} <span class="helptext">{{ field.help_text }}</span></li>
                    <li class="error" class="errors_{{ field.name }}">{{ field.errors }}</li>
                    {% endif %}
                {% endfor %}
                </ul>
                <input type="hidden" class="hqmedia_upload_id" value="{{ progress_id }}" />
                <input type="submit" value="Upload Zip File" />
                <div id="hqmedia_upload_status"></div>
            </form>
            <div>Upload progress: <span id="hqmedia_progressbar"></span></div>
            <div>Processing progress: <span id="hqmedia_processing_progressbar"></span></div>
        </div>
        <div id="failed_files">
            <ul></ul>
        </div>
    </div>
</div>
{% endblock %}