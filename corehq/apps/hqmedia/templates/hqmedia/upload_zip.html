{% extends base_template %}
{% block head %}{{ block.super }}
    <link rel="stylesheet" href="{{ STATIC_URL }}hqmedia/css/media_upload.css" />
{#    <style type="text/css">#}
{#        .uploadButton a {#}
{#            display:block;#}
{#            width:100px;#}
{#            height:40px;#}
{#            text-decoration: none;#}
{#        }#}
{##}
{#        .uploadButton a {#}
{#            background: #cccccc;#}
{#        }#}
{##}
{#        .uploadButton a:visited {#}
{#            background-position: 0 0;#}
{#        }#}
{##}
{#        .uploadButton a:hover {#}
{#            background-position: 0 -40px;#}
{#        }#}
{##}
{#        .uploadButton a:active {#}
{#            background-position: 0 -80px;#}
{#        }#}
{#    </style>#}
{% endblock %}
{% block js %} {{ block.super }}
    <script type="text/javascript" src="http://yui.yahooapis.com/combo?3.4.1/build/yui-base/yui-base-min.js&3.4.1/build/oop/oop-min.js&3.4.1/build/event-custom-base/event-custom-base-min.js&3.4.1/build/event-custom-complex/event-custom-complex-min.js&3.4.1/build/features/features-min.js&3.4.1/build/dom-core/dom-core-min.js&3.4.1/build/dom-base/dom-base-min.js&3.4.1/build/selector-native/selector-native-min.js&3.4.1/build/selector/selector-min.js&3.4.1/build/node-core/node-core-min.js&3.4.1/build/node-base/node-base-min.js&3.4.1/build/event-base/event-base-min.js&3.4.1/build/event-delegate/event-delegate-min.js&3.4.1/build/node-event-delegate/node-event-delegate-min.js&3.4.1/build/pluginhost-base/pluginhost-base-min.js&3.4.1/build/pluginhost-config/pluginhost-config-min.js&3.4.1/build/node-pluginhost/node-pluginhost-min.js&3.4.1/build/dom-style/dom-style-min.js&3.4.1/build/dom-screen/dom-screen-min.js&3.4.1/build/node-screen/node-screen-min.js&3.4.1/build/node-style/node-style-min.js&3.4.1/build/attribute-base/attribute-base-min.js&3.4.1/build/base-base/base-base-min.js&3.4.1/build/base-pluginhost/base-pluginhost-min.js&3.4.1/build/base-build/base-build-min.js&3.4.1/build/swfdetect/swfdetect-min.js&3.4.1/build/escape/escape-min.js&3.4.1/build/swf/swf-min.js&3.4.1/build/uploader/uploader-min.js"></script>
{#<script type="text/javascript" src="{{ STATIC_URL }}hqmedia/js/jquery.form.js"></script>#}
{#<script type="text/javascript" src="{{ STATIC_URL }}hqmedia/js/jquery.progressbar.min.js"></script>#}
{#<script type="text/javascript" src="{{ STATIC_URL }}hqmedia/js/hqmedia_upload.js"></script>#}
{#<script type="text/javascript">#}
{#    $().ready(function() {#}
{#        var $failed_files = $("#failed_files");#}
{##}
{#        var hqUpload;#}
{#        hqUpload = new HQMediaUpload({#}
{#            progress_id_varname: '{{ progress_id_varname }}',#}
{#            submit_url: '{% url multimedia_upload domain 'zip' app.get_id %}',#}
{#            progress_checker_url: '{% url hqmedia_upload_progress domain%}',#}
{#            static_url: '{{ STATIC_URL }}',#}
{#            processbar: '#hqmedia_processing_progressbar',#}
{#            process_checker_url: '{% url hqmedia_upload_success domain %}',#}
{#            process_complete_fn: showFailedFiles#}
{#        });#}
{##}
{#        $failed_files.fadeOut();#}
{#        hqUpload.listenForUploads();#}
{##}
{#        function showFailedFiles(data) {#}
{#           $("#return-to-map").removeClass("inactive");#}
{#           if(data.successful) {#}
{#               $failed_files.prepend($("<h3 />").text("We could not find references to the following files in your application:"));#}
{#               $failed_files.show('blind');#}
{#           }#}
{#           for(var i = 0; i < data.successful.length; i++) {#}
{#               $("#failed_files ul").append($("<li />").text(data.successful[i]));#}
{#           }#}
{#        }#}
{#    });#}
{#</script>#}
{% endblock %}
{% block js-inline %} {{ block.super }}
    <script type="text/javascript">
        function PhotosUploader() {
            var self = this;

            self.render = function() {
                YUI().use("uploader", function(Y) {
                    var uploader;
                    Y.on("domready", init);

                    function init () {
                        var overlayRegion = Y.one("#select-photos-a").get('region');
                        Y.log(overlayRegion);
                        Y.one("#uploader-overlay").set("offsetWidth", overlayRegion.width);
                        Y.one("#uploader-overlay").set("offsetHeight", overlayRegion.height);

                        uploader = new Y.Uploader({boundingBox:"#uploader-overlay"});

                        uploader.on("uploaderReady", setupUploader);
                        uploader.on("fileselect", fileSelect);
                        uploader.on("uploadprogress", updateProgress);
                        uploader.on("uploadcomplete", uploadComplete);

                        Y.one("#upload-photos-a").on("click", uploadFile);
                    }

                    function setupUploader(event) {
                        uploader.set("multiFiles", true);
                        uploader.set("simLimit", 3);
                        uploader.set("log", true);

                        var fileFilters = new Array({description:"Images", extensions:"*.jpg"});
                        uploader.set("fileFilters", fileFilters);
                    }

                    function fileSelect(event) {
                        Y.log("File was selected, parsing...");
                        var fileData = event.fileList;
                        for (var key in fileData) {
                            var output = '<tr>\
                        <td>'+fileData[key].name+'</td>\
                        <td>'+fileData[key].size+'</td>\
                        <td><div id="div_'+fileData[key].id+'">0</div></td>\
                    </tr>';
                            Y.one("#filenames").append(output);
                        }
                    }

                    function updateProgress(event) {
                        $('#div_'+event.id).text(Math.round(100 * event.bytesLoaded / event.bytesTotal));
                    }

                    function uploadComplete(event) {
                        $('#div_'+event.id).text(100);
                    }

                    function uploadFile(event) {
                        uploader.uploadAll('{{ DNS_name }}{% url hqmedia_handle_uploaded domain app.get_id %}');
                    }
                });
            };
        }
    </script>
    <script type="text/javascript">
        $(document).ready(function() {
            var pu = new PhotosUploader();
            pu.render();
        });
    </script>
{% endblock %}

{% block content %}
<div id="main_container">
    <div class="padded multimedia">
        <nav class="breadcrumbs">
            <ul>
                <li><a href="{% url view_app domain app.get_id %}">Application "{{ app.name }}"</a></li>
                <li><a href="{% url multimedia_map domain app.get_id %}">Multimedia Map</a></li>
                <li>Upload Zip</li>
            </ul>
        </nav>
        <h1>Upload a ZIP of Multimedia Files for Application "{{ app.name }}"</h1>
        <p>Note: If you are having issues with large files, try breaking up the zip file into several separate smaller zip files.</p>
{#        <form action="" id="hqmedia_upload" method="post" enctype="multipart/form-data">#}
{#            <fieldset>#}
{#                <ul>#}
{#                {% for field in zipform %}#}
{#                    {% if field.field.required %}#}
{#                    <li>{{ field.label_tag }} {{ field }} <span class="helptext">{{ field.help_text }}</span></li>#}
{#                    <li class="error" id="errors_{{ field.name }}">{{ field.errors }}</li>#}
{#                    {% endif %}#}
{#                {% endfor %}#}
{#                </ul>#}
{#                <ul class="advanced-options">#}
{#                {% for field in zipform %}#}
{#                    {% if not field.field.required %}#}
{#                    <li>{{ field }} {{ field.label_tag }}</li>#}
{#                    <li class="error" class="errors_{{ field.name }}">{{ field.errors }}</li>#}
{#                    {% endif %}#}
{#                {% endfor %}#}
{#                </ul>#}
{#            </fieldset>#}
{#            <input type="hidden" class="hqmedia_upload_id" value="{{ progress_id }}" />#}
{#            <input type="submit" value="Upload Zip File" />#}
{#            <div id="hqmedia_upload_status"></div>#}
{#        </form>#}
{#        <div>Upload progress: <span id="hqmedia_progressbar"></span></div>#}
{#        <div>Processing progress: <span id="hqmedia_processing_progressbar"></span></div>#}
{##}
{#        <div><a href="{% url multimedia_map domain app.get_id %}" id="return-to-map" class="button inactive">Return to Multimedia Map</a></div>#}
{#        <div id="failed_files">#}
{#            <ul></ul>#}
{#        </div>#}
        <div id="upload-box" class="upload-box">
            <div id="uploader-box">
                <div id="uploader-overlay" style="position:absolute; z-index:2"></div>
                <div id="select-photos-box" style="z-index:1">
                    <a id="select-photos-a" href="#">Select JPEG photos</a>
                </div>
            </div>
            <div id="upload-photos-a">
                <a id="upload-a" href="#">Upload photos</a>
            </div>
            <div id="files">
                <table id="filenames">
                    <tr><td>Filename</td><td>File size</td><td>Percent uploaded</td></tr>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}