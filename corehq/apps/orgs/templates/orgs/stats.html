{% extends "orgs/orgs_landing.html" %}
{% load hq_shared_tags %}
{% load hqstyle_tags %}
{% load i18n %}

{% block js %}{{ block.super }}
    {% include "imports/datatables.html" %}
    <script type="text/javascript" src="{% static 'reports/javascripts/config.dataTables.bootstrap.js' %}"></script>
    <script type="text/javascript" src="{% static 'hqwebapp/js/lib/jquery-ui-datepicker/jquery-ui-1.8.17.custom.datepicker.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'reports/javascripts/datepicker.js' %}"></script>

    <link href="{% static 'hqwebapp/js/lib/nvd3/src/nv.d3.css' %}" rel="stylesheet">
    <script src="{% static 'hqwebapp/js/lib/nvd3/lib/d3.v2.js' %}"></script>
    <script src="{% static 'hqwebapp/js/lib/nvd3/lib/fisheye.js' %}"></script>
    <script src="{% static 'hqwebapp/js/lib/nvd3/nv.d3.js' %}"></script>
{% endblock %}

{% block js-inline %} {{ block.super }}
    <script src='{% static 'hqadmin/js/date_histogram_chart.js' %}' type='text/javascript'></script>
    <script type="text/javascript">
        var domain_data;
        $(function() {
            var reportTables = new HQReportDataTables({
                {% if aoColumns %}aoColumns: {{ aoColumns|JSON }}{% endif %}
            });
            reportTables.render();

            $project_filter_checkboxes = $('#filter-projects-form').find(':checkbox');
            $(document).on('click', '#select-btn', function() {
                $project_filter_checkboxes.attr('checked', true);
            });
            $(document).on('click', '#deselect-btn', function() {
                $project_filter_checkboxes.attr('checked', false);
            });

            // Charts ==================================================================================================
            var forms_data = {{ forms_data|JSON }};
            var cases_data = {{ cases_data|JSON }};

            //set starting and ending times
            var starting_time = new Date({{ startdate.0 }}, {{ startdate.1 }}, {{ startdate.2 }}).getTime();
            var ending_time = new Date({{ enddate.0 }}, {{ enddate.1 }}, {{ enddate.2 }}).getTime();

            addHistogram('form-submissions-chart', '# of form submissions', forms_data, starting_time, ending_time);
            addHistogram('cases-chart', '# of case modifications', cases_data, starting_time, ending_time);
        });
    </script>
{% endblock %}

{% block carded-content %}
    <div class="accordion" id="charts-accordion">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#charts-accordion" href="#form-graph">
                    {% trans "Form Submissions" %}
                </a>
            </div>
            <div id="form-graph" class="accordion-body collapse in">
                <div class="accordion-inner">
                    <div id='form-submissions-chart'>
                        <svg style='height:320px'> </svg>
                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#charts-accordion" href="#case-graph">
                    {% trans "Case Modifications" %}
                </a>
            </div>
            <div id="case-graph" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div id='cases-chart'>
                        <svg style='height:320px'> </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <hr />
    {% include "reports/partials/generic_filters.html" %}
    <div id="report-content">
        {% include "domain/partials/report_list.html" with domains=domains_for_report %}
    </div>
    <hr />
    <form id="filter-projects-form" action="{% url orgs_stats org.name %}" method="get">
        <h3>{% trans "Filter Project Spaces" %}
            <div class="btn-toolbar pull-right">
                <button type="submit" class="btn btn-primary"><strong>{% trans "Filter" %}</strong></button>
                <div class="btn-group">
                    <button type="button" id="select-btn" href="#" class="btn">{% trans "Select All" %}</button>
                    <button type="button" id="deselect-btn" href="#" class="btn">{% trans "Deselect All" %}</button>
                </div>
            </div>
        </h3>
        <div class="well" id="domain-filter">
            <div class="row-fluid">
                {% for dom in domains %}
                    {% if forloop.counter0|divisibleby:"4" and forloop.counter0 != 0 %}
                        </div><div class="row-fluid">
                    {% endif %}
                    <div class="span3">
                        <label class="checkbox">
                            <input type="checkbox" name="name" value="{{ dom.name }}" {% if dom.active_in_filter %}checked{% endif %}> <strong>{{ dom.display_name }}</strong>
                        </label>
                    </div>
                {% endfor %}
            </div>
        </div>
    </form>
{% endblock %}

{% block org-modals %}
{% endblock %}
