{% extends "hqwebapp/two_column.html" %}
{% load hq_shared_tags %}

{% block js %}{{ block.super }}
{% include "imports/datatables.html" %}
<script type="text/javascript" src="{% static 'reports/javascripts/config.dataTables.bootstrap.js' %}"></script>
{% include "imports/flot.html" %}
<script type="text/javascript" src="{% static 'hqwebapp/javascripts/jquery-ui-datepicker/jquery-ui-1.8.17.custom.datepicker.min.js' %}"></script>
<script type="text/javascript" src="{% static 'hqwebapp/javascripts/jquery.history.js' %}"></script>
<script type="text/javascript" src="{% static 'reports/javascripts/async_reports.js' %}"></script>
{% endblock %}

{% block js-inline %}{{ block.super }}
{% if not report_hide_filters %}
    <script type="text/javascript">
        $(function() {
            var reportFilterCookieName = '{{ slug }}reportFiltersHidden',
                    savedPath = '/a/{{ domain }}/';
            $("#reportFilters").addClass($.cookie(reportFilterCookieName));
            if($.cookie(reportFilterCookieName) == 'in')
                $("#toggle-report-filters").button('hide');
            else
                $("#toggle-report-filters").button('show');

            $("#reportFilters").on('hidden', function () {
                $.cookie(reportFilterCookieName, '', {path: savedPath, expires: 1});
                $("#toggle-report-filters").button('show');
            });
            $("#reportFilters").on('shown', function () {
                $.cookie(reportFilterCookieName, 'in', {path: savedPath, expires: 1});
                $("#toggle-report-filters").button('hide');
            });

            $("#export-report-excel").click(function () {
                var params = window.location.search.substr(1);
                window.location.href = window.location.pathname.replace('/{{ base_slug|default:'reports' }}/', '/{{ base_slug|default:'reports' }}/export/')+"?"+params;
            });

            {% if slug and async_report %}
            var asyncReport = new HQAsyncReport({
                baseSlug: '{{ base_slug|default:'reports' }}'
            });
            asyncReport.init();
            {% endif %}
        });
    </script>
{% endif %}
{% endblock %}

{% block head %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'hqwebapp/javascripts/jquery-ui-datepicker/datepicker-theme/jquery-ui-1.8.17.custom.css' %}" />
{% endblock %}

{% block title %} - Report: {{ report.name|default:"Unknown Report"|safe }}{% endblock %}

{% block page-title %}
    <ul class="breadcrumb">
        <li>
            <a href="{% url default_report domain %}"><strong>Reports</strong></a> <span class="divider">&gt;</span>
        </li>
        {% if not report_breadcrumbs %}
        <li class="active">
            <div id="report-title"><a href="#">{{ report.name|default:"Unknown Report"|safe }}</a></div>
        </li>
        {% else %}
        {{ report_breadcrumbs|safe }}
        {% endif %}
    </ul>
{% endblock %}

{% block sidebar %}{% include "reports/partials/report_list.html" %}{% endblock %}
{% block main_column %}
    <div class="hq-accordion-control{% if async_report%} hide{% endif %}" id="reportFiltersAccordion">
        <div class="accordion-heading">
            <div class="accordion-actions">
            {% if not report_hide_filters or exportable %}
                <span>Report Actions:</span> 
                {% if not report_hide_filters %}<a href="#reportFilters" class="btn" id="toggle-report-filters" data-toggle="collapse" data-show-text="Show Filter Options" data-hide-text="Hide Filter Options">Filter Options</a>{% endif %}
                {% if exportable %}<a href="#" class="btn" id="export-report-excel"><i class="icon icon-share"></i> Export to Excel</a>{% endif %}
            {% endif %}
            </div>
            <div id="extra-filter-info" class="accordion-extra"></div>
        </div>
        {% if not report_hide_filters %}
        <div id="reportFilters" class="accordion-body collapse">
            <div class="accordion-inner">
                <form method="get" id="paramSelectorForm" class="form-horizontal">
                    <div id="hq-report-filters">
                        {% if not async_report %}
                            {% include "reports/async/filters.html" %}
                        {% endif %}
                    </div>
                    <div class="form-actions">
                        <button type="submit" data-loading-text="Generating Report..." data-standard-text="Update Filters" class="btn btn-large disabled">Update Filters</button>
                        <a href="#reportFilters" data-toggle="collapse" class="btn btn-large">Close</a>
                    </div>
                </form>
            </div>
        </div>
        {% endif %}
    </div>
    <div id="report-content">
        {% if not async_report and slug %}
        {% block reportcontent %}
        {% endblock %}
        {% else %}
        {% include "reports/async/default.html" %}
        {% endif %}
    </div>
{% endblock %}

