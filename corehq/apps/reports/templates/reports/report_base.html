{% extends base_template %}
{% block page_imports %}
    {% include "imports/datatables.html" %}
    {% include "imports/flot.html" %}
{% endblock %}
{% block head %}
    {{ block.super }}

    <script>
        $(function(){
            $("#report_select").val(location.pathname);
            $("#report_select").change(function(){
                location.href = $(this).val();
            });
        });
    </script>
    <script type="text/javascript">
        function shiftDates(days) {
            start = new Date($("#startdate").val());
            start.setDate(start.getDate() + days);
            end = new Date($("#enddate").val());
            end.setDate(end.getDate() + days);
            $("#startdate").datepicker('setDate', start);
            $("#enddate").datepicker('setDate', end);
            $("#dateForm").submit();
        }
		$(function() {
		    $('.date-picker').datepicker( {
		        changeMonth: true,
		        changeYear: true,
		        showButtonPanel: true,
		        dateFormat: 'yy-mm-dd',
                maxDate: '0',
                numberOfMonths: 2,
		        /*onClose: function(dateText, inst) {
		            var month = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
		            var year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
		            $(this).datepicker('setDate', new Date(year, month, 1));
		        }*/
		    });
            $('#startdate').change(function(){
                $("#enddate").datepicker('option', 'minDate', $('#startdate').val());
            }).trigger('change');
            $("#previous_date").click(function(e){
                e.preventDefault();
                shiftDates(-7);
            })
            $("#next_date").click(function(e){
                e.preventDefault();
                shiftDates(7);
            })
		});
    </script>
    <script type="text/javascript">
        // datatable configuration.
        function start_datatables(elem){
            if(!elem){
                elem = document;
            }
            $('.datatable', elem).each(function(){
                $(this).dataTable({
                    "bJQueryUI": true,
                    "sAjaxSource": $(this).attr('data-source')
                });
            });
        }
        $(document).ready(function() {
            start_datatables();
        }); 
    </script>

    {% if show_users %}
        <script>
            $(function(){
                $("#individual_select").change(function(){
                    $(this).parent().submit();
                });

                $("#report-tabs").tabs({
                    cookie: {},
                    ajaxOptions: {
                        error: function( xhr, status, index, anchor ) {
                            $( anchor.hash ).html(
                                "Couldn't load this tab. We'll try to fix this as soon as possible. "
                            );
                        }
                    },
                    load: function(event, ui){
                        $.ui = ui;
                        start_datatables(ui.panel);

                    }
                }).removeClass('ui-corner-all ui-widget-content').addClass('ui-corner-bottom').css('padding', '0');
                $("#report-tabs ul").removeClass('ui-corner-all');
            });
        </script>
    {% endif %}

    <style>
        .datatable {
            width: 100%;
        }
        #main_container {
            padding: 0;
        }
        #report_header {
            padding: 10px;
        }
    </style>
    {% block report_javascripts %}{% endblock %}
{% endblock %}
{% block content %}
    <div id="main_container">
        <div id="title-bar">
            <h1>Reports</h1>
            <select id="report_select">
                {% include "reports/partials/report_list.html" %}
            </select>
        </div>
        <div id="report_header">
            <h1>{{ report.name|default:"Unknown Report" }}</h1>
            {% if show_dates %}
                <form method="get" id="dateForm">
                    <p>Start Date: <input type="text" id="startdate" name="startdate" class="date-picker" value="{{ start_date }}">
                       End Date: <input type="text" id="enddate" name="enddate" class="date-picker" value="{{ end_date }}">
                       <input type="submit" value="Go!" />
                    </p>
                    <p>
                        <a href="#" id="previous_date">Previous week</a> | <a href="#" id="next_date">Next Week</a>
                    </p>
                </form>
            {% endif %}
            {% if show_users %}
                <form action="" method="GET">
                    <select id="individual_select" name="individual">
                        <option  value=''>All Individuals</option>
                        {% for user in users %}
                            <option {% if user.id == individual %}selected="true"{% endif %} value="{{ user.id }}">{{ user.username }}</option>
                        {% endfor %}
                    </select>
                </form>
            {% endif %}
        </div>
        {% block reportcontent %}Your report goes here{% endblock %}
    </div>
{% endblock %}