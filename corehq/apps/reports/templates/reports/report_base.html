{% extends base_template %}
{% load hq_shared_tags %}

{# stuff to override old styles -- remove when everything is migrated over #}
{% block oldstyle_tag %}{% endblock %}
{% block oldstyle_imports %}{% endblock %}
{% block oldstyle_hack_start %}{% endblock %}
{% block oldstyle_hack_end %}{% endblock %}

{% block js %}{{ block.super }}
{% include "imports/datatables.bootstrap.html" %}
{% include "imports/flot.html" %}
<script type="text/javascript" src="{% static 'hqwebapp/javascripts/jquery-ui-datepicker/jquery-ui-1.8.17.custom.datepicker.min.js' %}"></script>
<script type="text/javascript" src="{% static 'reports/javascripts/datepicker.js' %}"></script>
<script type="text/javascript" src="{% static 'hqwebapp/js-custom/hq.new-notify.js' %}"></script>
{% endblock %}

{% block js-inline %}{{ block.super }}
    {% if slug %}
    <script type="text/javascript">
        $(function() {
            var reportFilterCookieName = '{{ slug }}_reportFiltersHidden',
                    savedPath = '/a/{{ domain }}/reports/{{ slug }}';
            $("#reportFilters").addClass($.cookie(reportFilterCookieName));
            $("#reportFilters").on('hidden', function () {
                $.cookie(reportFilterCookieName, '', {path: savedPath});
            });
            $("#reportFilters").on('shown', function () {
                $.cookie(reportFilterCookieName, 'in', {path: savedPath});
            });
        });
    </script>
    {% endif %}
{% endblock %}

{% block head %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'hqwebapp/javascripts/jquery-ui-datepicker/datepicker-theme/jquery-ui-1.8.17.custom.css' %}" />
{% endblock %}

{% block page-title %}
    <ul class="breadcrumb">
        <li>
            <a href="{% url default_report domain %}"><strong>Reports</strong></a> <span class="divider">&gt;</span>
        </li>
        <li class="active">
            <div id="report-title"><a href="#">{{ report.name|default:"Unknown Report"|safe }}</a></div>
        </li>
    </ul>
{% endblock %}

{% block content %}
    <div class="row-fluid">
        <div class="sidebar span2">
            {% include "reports/partials/report_list.html" %}
        </div>
        <div class="{% if slug or is_tabular %}hq-flush-content{% else %}hq-content{% endif %} span10">
            {% block reportpresentation %}
            <div class="hq-accordion-control">
                <div class="accordion-heading">
                    <a href="#reportFilters" data-toggle="collapse">Advanced Filters</a>
                    <div id="extra-filter-info" class="accordion-extra"></div>
                </div>

                <div id="reportFilters" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <form method="get" id="paramSelectorForm" class="form-horizontal">
                            {% if custom_fields %}
                                <fieldset>
                                <legend>Report Filters</legend>
                                {% for field in custom_fields %}
                                    <div id="{{ field.slug }}" class="control-group">
                                        {{ field.field|safe }}
                                    </div>
                                {% endfor %}
                                </fieldset>
                            {% endif %}
                            {% if show_dates or custom_fields or show_user_filter %}
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-large btn-primary">Update Filters</button>
                                    <a href="#reportFilters" data-toggle="collapse" class="btn btn-large">Cancel</a>
                                </div>
                            {% endif %}
                        </form>
                    </div>
                </div>
            </div>
            {% if show_time_notice %}{% include "hqwebapp/partials/time-notice.html"%}{% endif %}
            <div id="report-content">
            {% block reportcontent %}Your report goes here{% endblock %}
            </div>
            {% endblock %}
        </div>
    </div>
    <div id="report-footer">
    {% if exportable %}
        Export current view to:
        {% for f in export_formats %}
            <a href="{{ export_path|safe }}&format={{ f }}">{{ f }}</a>
        {% endfor %}
    {% endif %}
    </div>
{% endblock %}