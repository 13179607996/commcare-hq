{% extends "hqwebapp/two_column.html" %}
{% load hq_shared_tags %}
{% load i18n %}
{% load compress %}

{% block stylesheets %}

{% if less_debug %}
<link type="text/less"
    rel="stylesheet"
    media="all"
    href="{% static 'cloudcare/less/font-formplayer.less' %}" />
<link type="text/less"
    rel="stylesheet"
    media="all"
    href="{% static 'cloudcare/less/formplayer-common.debug.less' %}" />
<link type="text/less"
    rel="stylesheet"
    media="all"
    href="{% static 'cloudcare/less/formplayer-webapp.debug.less' %}" />
{% else %}
{% compress css %}
  <link type="text/less"
        rel="stylesheet"
        media="all"
        href="{% static 'cloudcare/less/font-formplayer.less' %}" />
  <link type="text/less"
        rel="stylesheet"
        media="all"
        href="{% static 'cloudcare/less/formplayer-common.less' %}"/>
  <link type="text/less"
        rel="stylesheet"
        media="all"
        href="{% static 'cloudcare/less/formplayer-webapp.less' %}"/>
{% endcompress %}
{% endif %}

{% endblock %}

{% block js %}{{ block.super }}
    <script src="{% static "reports/js/edit_submission.js" %}"></script>
{% endblock %}

{% block js-inline %}{{ block.super }}
    {% include 'cloudcare/includes/formplayer-inline.html' %}
{% endblock %}

{% block head %}{{ block.super }}
    <script>
    $(function () {
        var initialPageData = hqImport("hqwebapp/js/initial_page_data").get;
        GMAPS_API_KEY = initialPageData('maps_api_key'); // maps api is a global variable depended on by touchforms
        var edit_context = initialPageData("edit_context");
        var uses_sql_backend = initialPageData("use_sqlite_backend");
        var username = initialPageData("username");
        var edit_formplayer = initialPageData("edit_formplayer");
        var restoreAs = edit_context.sessionData.username;
        $('#edit-container').inlineFormplayer({
            formUrl: edit_context.formUrl,
            submitUrl: edit_context.submitUrl,
            sessionData: edit_context.sessionData,
            uses_sql_backend: uses_sql_backend,
            formplayerEnabled: edit_formplayer,
            domain: edit_context.domain,
            username: username,
            restoreAs: restoreAs,
            onsubmit: function () {
                window.location.href = edit_context.returnUrl;
            },
            onload: function () {
            }
        });
    });
    </script>
{% endblock %}

{% block title %}{% trans 'Edit Submission' %}{% endblock %}
{% block page_breadcrumbs %}{{ block.super }}
    {% include 'reports/form/partials/form_breadcrumbs.html' %}
{% endblock %}

{% block page_content %}
    {% initial_page_data 'edit_context' edit_context %}
    {% initial_page_data 'edit_formplayer' edit_formplayer %}
    {% initial_page_data 'maps_api_key' maps_api_key %}
    {% initial_page_data 'use_sqlite_backend' use_sqlite_backend %}
    {% initial_page_data 'username' username %}

    <div class="inline-touchforms" data-bind="template: { name: 'form-fullform-ko-template' }" id="edit-container"></div>
    <div id="loading" class="hq-loading" style="display: none;">
        <img width="32" height="32" alt="Loading" src="{% static 'formplayer/img/loading_transparent.gif' %}" />
        {% trans "Loading" %}...
    </div>
{% endblock %}
