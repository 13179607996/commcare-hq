{% extends "cloudcare/base.html" %}
{% load i18n %}
{% load hq_shared_tags %}
{% load compress %}

{% block title %}
    {% if request.couch_user.is_web_user %}
        {% trans "Preview Form" %}
    {% else %}
        {% trans "Formplayer" %}
    {% endif %}
{% endblock %}

{% block head %}
    {{ block.super }}
    {% include "imports/proptable.html" %}
    {% include "imports/fancy-code.html" %}

    <script src="{% static 'datatables/media/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'datatables/media/js/dataTables.bootstrap.min.js' %}"></script>

{% endblock %}

{% block js %} {{ block.super }}
    {% compress js %}
            <script src="{% static 'jquery/dist/jquery.min.js' %}"></script>
            <script src="{% static 'json2/json2.js' %}"></script>
            <script src="{% static 'underscore/underscore.js' %}"></script>
            <script src="{% static 'backbone/backbone-min.js' %}"></script>
            <script src="{% static 'backbone.marionette/lib/backbone.marionette.min.js' %}"></script>
            <script src="{% static 'cloudcare/js/formplayer/app.js' %}"></script>
    {% endcompress %}
{% endblock %}

{% block js-inline %} {{ block.super }}
<script>
    var formPlayer = hqImport('cloudcare/js/formplayer/app.js');
    var apps = {{ apps|JSON }};
    console.log(apps)
    FormplayerFrontend.start();
</script>
    <script>
        $(function() {
           window.onbeforeunload = function() {
               if (window.mainView.router.view && window.mainView.router.view.dirty) {
                   return translatedStrings.navigateDirty;
               }
           }
        }())
    </script>
{% endblock %}

{% block page_navigation %}
    <div class="nav-input" id="sync-container">
        <button
                class="btn btn-block btn-success"
                type="button"
                id="sync-button">
            {% trans "Sync Data" %}
        </button>
        <small>
            <i class="fa fa-info-circle"></i>&nbsp;
            {% trans "Click to refresh the data and process all recently submitted cases" %}
        </small>
    </div>
    <section id="app-main">
        <nav id="app-list"></nav>
        {% if sessions_enabled %}
            <nav id="sessions"></nav>
        {% endif %}
    </section>
{% endblock %}

{% block page_content %}
    {% if request.couch_user.is_web_user %}
        <div class="alert fade in alert-block alert-full alert-warning ">
            <a class="close" data-dismiss="alert" href="#">&times;</a>
                {% blocktrans %}
                    You are previewing a form as a web user!
                    Any data you submit will show up in reports as submitted by "Unknown User". There are a
                    few features that rely on mobile workers and will not work properly:
                    <ul>
                        <li>Case sharing</li>
                        <li>Lookup tables</li>
                        <li>User-as-a-case</li>
                    </ul>
                    For the best experience please logout and login as a Mobile Worker.
                    More information can be found at the <a href="https://help.commcarehq.org/display/commcarepublic/CloudCare+-+Web+Data+Entry">CommCare Help Site</a>.
                {% endblocktrans %}
        </div>
    {% endif %}
    <div id="cloudcare-main">
        {% if not apps_raw %}
            <h3>No Apps found</h3>
            {% blocktrans %}
                <p>
                    Sorry, it doesn't look like you have any CloudCare apps
                    available. To learn more about how to enable and use
                    CloudCare, please check out our
                    <a href="https://confluence.dimagi.com/pages/viewpage.action?pageId=10224014" target="_blank">wiki documentation</a>.
                </p>
            {% endblocktrans %}
            {% if use_cloudcare_releases %}
                {% blocktrans %}
                <p>
                    CloudCare displays the latest starred version of the
                    application. Make sure you have enabled CloudCare and
                    starred a version of your application.
                </p>
                {% endblocktrans %}
            {% endif %}
        {% endif %}
        <section id="cloudcare-notifications"></section>
        <section id="menu-view"></section>
        <section id="webforms" class="webforms" data-bind="template: { name: 'form-fullform-ko-template' }"></section>
        {% if request|toggle_enabled:"INSTANCE_VIEWER" %}
        <section id="cloudcare-debugger" data-bind="
            template: {
                name: 'instance-viewer-ko-template',
                afterRender: adjustWidth
            }
        "></section>
        {% endif %}
    </div>

    {% include 'cloudcare/includes/case_details.html' %}
    {% include 'formplayer/fullform-ui/templates.html' %}

{% endblock %}