{% extends "new_xforms/apps_base.html" %}
{% load xforms_extras %}
{% block head %}
{% endblock %}
{% block app-content %}
    <div id="langs" class="container">
        Language:
        <select class="code">
            {% for lang in app.langs %}
            <option value="./?{% if edit %}edit=true;{% endif %}lang={{ lang }}"{% if lang == langs.0 %} selected=""{% endif %}>{{ lang }}</option>
            {% endfor %}
        </select>

    </div>
    <div id="modules-form-view-wrapper">
        <div id="modules">
        <!--h2 id="modules-header">Modules</h2-->
        <h2 {% if not module and not form %}class="selected"{% endif %}><!--[A]--> <a href="{% url corehq.apps.new_xforms.views.app_view domain app.id %}{% if edit %}?edit=true{% endif %}">{{ app.name|trans:langs}}</a></h2>
        <ul {% if edit %}class="sortable"{% endif %}>
            {% if edit %}
                <li class="sort-action">
                    <form method="post" action="{% url corehq.apps.new_xforms.views.swap domain app.id 'modules' %}">
                    </form>
                </li>
            {% endif %}
            {% with module as selected_module %}
            {% for module in app.get_modules %}
            <li class="module">
                {% if edit %}<div class="index">{{ module.id }}</div>{% endif %}
                <div {% ifequal module.id selected_module.id %}{% if not form %} class="selected"{% endif %}{% endifequal %}><!--[M]-->
                    {% if edit %}
                        [<a class="delete_link" href="#"
                            >x</a>]
                        <div class="delete_dialog" title="Delete {{ module.name|trans:langs }}?">
                            <form action="{% url corehq.apps.new_xforms.views.delete_module domain app.id module.id %}" method="POST">
                                <table>
                                    <tr><td>
                                    Are you sure you want to delete module "{{ module.name|trans:langs }}"
                                    and all its forms from application "{{ app.name|trans:app.langs }}"?
                                    </td></tr>
                                </table>
                                <input type="submit" value="Delete" />
                            </form>
                        </div>
                    {% endif %}
                    <a href="{% url corehq.apps.new_xforms.views.module_view domain app.id module.id %}{% if edit %}?edit=true{% endif %}">
                        {{ module.name|trans:langs }}
                    </a>
                </div>
                <ul class="{% ifequal module.id selected_module.id %}selected{% endifequal %} {% if edit %}sortable{% endif %}">
                    {% if edit %}
                        <li class="sort-action">
                            <form method="post" action="{% url corehq.apps.new_xforms.views.swap domain app.id 'forms' %}">
                                <input type="hidden" name="module_id" value="{{ module.id }}" />
                            </form>
                        </li>
                    {% endif %}
                    {% with form as selected_form %}
                    {% for form in module.get_forms %}
                    <li {% ifequal form selected_form %} class="selected"{% endifequal %}><!--[F]-->
                        {% if edit %}<div class="index">{{ form.id }}</div>{% endif %}
                        {% if edit %}
                        [<a class="delete_link" href="#"
                            >x</a>]
                        <div class="delete_dialog" title="Delete {{ form.name|trans:langs }}?">
                            <form action="{% url corehq.apps.new_xforms.views.delete_form domain app.id module.id form.id %}" method="POST">
                                <table>
                                    <tr><td>
                                    Are you sure you want to delete form "{{ form.name|trans:langs }}"
                                    from module "{{ module.name|trans:langs }}"?
                                    </td></tr>
                                </table>
                                <input type="submit" value="Delete" />
                            </form>
                        </div>
                        {% endif %}
                        <a href="{% url corehq.apps.new_xforms.views.form_view domain app.id module.id form.id %}{% if edit %}?edit=true{% endif %}">
                            {{ form.name|trans:langs }}
                        </a>
                    </li>
                    {% endfor %}
                    {% endwith %}
                    {% if not module.forms and not edit %}
                        <li> <p class="warning">No Forms</p></li>
                    {% endif %}
                    {% if edit %}
                    <li>
                        [<a href="{% url corehq.apps.new_xforms.views.new_form domain app.id module.id %}"
                            >+</a>]
                    </li>
                    {% endif %}

                </ul>
            </li>
            {% endfor %}
            {% endwith %}
            {% if edit and app.doc_type == "Application" %}
                [<a href="#" id="new_module">+</a>]
                <div id="new_module_dialog" title="Create New Module">
                    <form action="{% url corehq.apps.new_xforms.views.new_module domain app.id %}" method="post">
                        <table>
                            {{ new_module_form.as_table }}
                        </table>
                        <input type="submit" value="Create Module" />
                    </form>

                </div>
            {% endif %}
        </ul>
        </div>
        <div id="form-view">
            {% block form-view %}
                {% if app.modules %}
                    {% if form %}
                        <h3>{% if module %}{{ module.name|trans:langs }} &gt; {% endif %}{{ form.name|trans:langs }}</h3>
                        {% if xform%}
                            <table class="config">
                                <tr>
                                    <th>XML Namespace</th>
                                    <td><code>{{ xform.xmlns }}</code></td>
                                </tr>
                                <tr>
                                    <th>Requires</th>
                                    <td>{{ form.requires }}</td>
                                </tr>
                            </table>
                        {% else %}
                            <p>This xform doesn't seem to exist. Would you like to create one with this name?</p>
                            <a class="button" href="{% url corehq.apps.new_xforms.views.new_form domain app.id module.id %}?form_name={{ form.name }}">Create Form</a>

                        {% endif %}
                    {% else %}{% if module %}
                        <h3>{{ module.name|trans:langs }} Module Configurations</h3>
                        <form action="">
                        </form>
                    {% else %}{% if app %}
                        App settings will go here...
                    {% else %}
                        {% if edit %}
                            <h2 class="message">Continue editing at the left or click "Done Editing" above.</h2>
                        {% else %}
                            <h2 class="message">Select a form at the left.</h2>
                        {% endif %}

                    {% endif %}
                    {% endif %}
                    {% endif %}
                {% else %}
                    <h2 class="message">Begin by adding a module at the left.</h2>
                {% endif %}
            {% endblock %}
        </div>
    </div>

{% endblock %}