{% extends "app_manager/v1/form_view_base.html" %}
{% load xforms_extras %}
{% load hq_shared_tags %}
{% load i18n %}

{% block js_extra %}
    <script src="{% static 'app_manager/js/case-config-ui-advanced.js' %}"></script>
    <script src="{% static 'app_manager/js/visit-scheduler.js' %}"></script>
{% endblock %}

{% block js-inline %}{{ block.super }}
{% if form.source %}
<script>
    var initial_page_data = hqImport("hqwebapp/js/initial_page_data.js").get;
    var form_requires = ko.observable({{ form.requires|JSON }});
    var CaseConfig = hqImport('app_manager/js/case-config-ui-advanced.js').CaseConfig;
    var caseConfig = new CaseConfig(_.extend({}, initial_page_data("case_config_options"), {
        home: $('#case-config-ko'),
        requires: form_requires,
        save_url: "{% url "edit_advanced_form_actions" app.domain app.id module.id nav_form.id %}",

        {% if form.form_type == "shadow_form" %}
            actions: {{ form.extra_actions|JSON }},
        {% else %}
            actions: {{ form.actions|JSON }},
        {% endif %}
        commtrack_enabled: {{ app.commtrack_enabled|JSON }},
        commtrack_programs: {{ commtrack_programs|JSON }},
        isShadowForm: {% if form.form_type == "shadow_form" %}true{% else %}false{% endif %},
        module_id: {{ module.unique_id|JSON }},
        propertyDescriptions: {{ property_descriptions|JSON }},
    }));
    caseConfig.init();


    {% if module.has_schedule  %}
    var VisitScheduler = hqImport('app_manager/js/visit-scheduler.js');
    var visitScheduler = new VisitScheduler.Scheduler({
        home: $('#visit-scheduler'),
        questions: {{ xform_questions|JSON }},
        save_url: "{% url "edit_visit_schedule" app.domain app.id module.id nav_form.id %}",
        schedule: {{ form.schedule|JSON }},
        schedule_form_id: {{ schedule_form_id|JSON }} || '',
        phase: {{ schedule_phase|JSON }},
        all_schedule_phase_anchors: {{ all_schedule_phase_anchors|JSON }}
    });
    visitScheduler.init();
{% endif %}
</script>
{% endif %}
{% endblock %}

{% block case_management_content %}
    {% include 'app_manager/v1/partials/case_config_advanced.html' %}
{% endblock %}
