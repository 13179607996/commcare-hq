{% load i18n %}
{% load hq_shared_tags %}
<div class="form-group">
        <label class="control-label col-sm-2">
            {% trans "Display Condition" %}
            <span class="hq-help-template"
                  data-title="{% trans "Display Condition" %}"
                  data-content="{% blocktrans %}The form will not appear in this module's form menu unless this condition is met. Read more on the <a target='_blank' href='https://confluence.dimagi.com/display/commcarepublic/Form+Display+Conditions'>Help Site</a>.{% endblocktrans %}"
            ></span>
        </label>
        <div id="form-filter" class="col-sm-4 row">
            <div data-bind="valueOrNoneUI: {
                value: formFilter,
                allowed: formFilterAllowed,
                messages: errorMessages,
            }">
            <div class="inner">
                <div data-bind="css: {'has-error': !allowed()}">
                    <textarea name="form_filter" class="form-control vertical-resize" data-bind="
                            xpathValidator: {text: inputValue, allowCaseHashtags: true,
                                             errorHtml: $('#formFilterXpathErrorHtml').html()}
                    "></textarea>
                    <div class="help-block" data-bind="visible: !allowed()">
                        <strong>{% trans "Error: Module Does Not Use Cases" %}</strong>
                        <div data-bind="html: messages.notAllowed"></div>
                    </div>
                </div>
                <span class="hide" id="caseReferenceNotAllowed">
                  {% if request|toggle_enabled:"USER_PROPERTY_EASY_REFS" %}
                    {% blocktrans %}
                    To use display conditions in a module which reference a case, <br/>
                        (1) the module <strong>Menu</strong> setting must be set to <em>Display module and then
                            forms</em> <br/>
                        (2) all the forms in the module must update or close a case, which means registration
                            forms must go in a separate module, or if your project uses user properties, your
                            display condition may use user properties.
                    {% endblocktrans %}
                  {% else %}
                    {% blocktrans %}
                    To use display conditions in a module which reference a case, <br/>
                        (1) the module <strong>Menu Mode</strong> setting must be set to <em>Display module and then
                            forms</em> <br/>
                        (2) all the forms in the module must update or close a case, which means registration
                            forms must go in a separate module, or if your project uses user case management, your
                            display condition may use the user case.
                    {% endblocktrans %}
                  {% endif %}
                </span>
                <span class="hide" id="userCaseReferenceNotAllowed">
                  {% if request|toggle_enabled:"USER_PROPERTY_EASY_REFS" %}
                    {% blocktrans %}
                    To use display conditions in a module which reference a user property, user properties must be
                    enabled for your project.
                    {% endblocktrans %}
                  {% else %}
                    {% blocktrans %}
                    To use display conditions in a module which reference a user case, user case management must be
                    enabled for your project.
                    {% endblocktrans %}
                  {% endif %}
                </span>
                <span class="hide" id="formFilterXpathErrorHtml">
                {% blocktrans %}
                    There is something wrong with the logic in the Form Display Condition.
                    Check to make sure your parentheses match and you are referencing case properties correctly.
                {% endblocktrans %}
                </span>
            </div>
            </div>
        </div>
    </div>
