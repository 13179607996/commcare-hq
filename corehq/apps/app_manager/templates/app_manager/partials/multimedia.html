{% load i18n %}

<script>
    $(function () {
        var multimedia_tab = (function () {
            var self = {};
            self.load_state = ko.observable(null);
            self.multimedia_page_html = ko.observable('');
            self.load_if_necessary = function () {
                if (!self.load_state() || self.load_state() === 'error') {
                    self.load_state('loading');
                    $.ajax({
                        url: '{% url 'app_multimedia_ajax' domain app.get_id %}'
                    }).success(function (content) {
                        self.load_state('loaded');
                        self.multimedia_page_html(content);
                    }).error(function () {
                        alert('Oops, there was a problem loading this section. Please try again.');
                        self.load_state('error');
                    });
                }
            };
            return self;
        }());
        ko.applyBindings(multimedia_tab, $("#multimedia").get(0));
        $('#multimedia-shower').on('show', function () {
            if (multimedia_tab.load_state() === null) {
                multimedia_tab.load_if_necessary();
            }
        });
    });
</script>

<h1>{% trans 'Manage Multimedia' %}</h1>
<div class="hq-loading" data-bind="visible: load_state() == 'loading'">
    <img src="/static/hqwebapp/img/ajax-loader.gif" alt="loading indicator">
    Loading
</div>

<div data-bind="html: multimedia_page_html"></div>

<div data-bind="if: load_state() === 'error'">
    <button class="btn" data-bind="click: load_if_necessary">{% trans "Try again" %}</button>
</div>
