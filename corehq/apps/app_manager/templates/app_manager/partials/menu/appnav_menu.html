{% load i18n %}
{% load xforms_extras %}
{% load hq_shared_tags %}

<ul class="sortable appmanager-main-menu appnav-menu appnav-module sortable-modules">
    <li class="sort-action">
        <form method="post"
              action="{% url "rearrange" domain app.id 'modules' %}">
              {% csrf_token %}
              <input name="ajax" value="true" type="hidden" />
        </form>
    </li>
    {% with module as selected_module %}
        {% for module in app.get_modules %}
            <li class="edit-module-li js-sorted-li module"
                data-index="{{ module.id }}"
                data-uid="{{ module.unique_id }}"
                data-rootModuleId="{{ module.root_module_id|default:"" }}"
                data-indexvar="moduleid">

                {% include 'app_manager/partials/menu/module_link.html' %}

                <ul class="appnav-menu appnav-menu-nested see sortable sortable-forms
                           {% ifequal module.unique_id selected_module.unique_id %}selected{% endifequal %}
                           {% if module.is_surveys %}appnav-surveys{% else %}appnav-caselist{% endif %}"
                    data-parentvar="moduleid">
                    <li class="sort-action">
                        <form method="post"
                              action="{% url "rearrange" domain app.id 'forms' %}">
                              {% csrf_token %}
                              <input name="ajax" value="true" type="hidden" />
                        </form>
                    </li>
                    {% with nav_form as selected_form %}
                        {% for form in module.get_forms %}
                            <li class="edit-form-li js-sorted-li"
                                data-moduleuid="{{ module.unique_id }}"
                                data-index="{{ form.id }}"
                                data-indexvar="formid"
                                {% if form.get_action_type == 'open' %}data-appear="first"{% endif %}
                            >
                                {% include 'app_manager/partials/menu/form_link.html' %}
                            </li>
                        {% endfor %}
                    {% endwith %}
                </ul>
            </li>
        {% endfor %}
    {% endwith %}
</ul>
<ul class="appnav-menu">
    {% if app.get_doc_type == "Application" %}
        <li class="sort-disabled">
            <div class="appnav-item">
                <form id="new-module-form"
                      action="{% url "new_module" domain app.id %}"
                      method="post"
                      class="hide">
                    {% csrf_token %}
                    <input id="new-module-type" type="hidden" name="module_type" />
                </form>
                <a href="#" class="appnav-add js-add-new-item" data-slug="module">
                    <i class="new-module-icon fa fa-plus"></i>
                    {% trans "Add..." %}
                </a>
            </div>
        </li>
    {% endif %}
</ul>

<div id="reorder_modules_modal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">
                    {% trans "Your modules were reordered" %}
                </h4>
            </div>
            <form action="{% url "reorder_child_modules" domain app.id %}"
                  method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <p class="lead">
                        {% trans "Your modules were reordered" %}
                    </p>
                    <p>
                        Click below to move these child modules under their parents.
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="disable-on-submit btn btn-danger">
                        Rearrange
                    </button>
                </div>
            </form>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
