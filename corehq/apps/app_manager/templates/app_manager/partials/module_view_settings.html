{% load xforms_extras %}
{% load hq_shared_tags %}
{% load i18n %}

<form class="form-horizontal save-button-form"
      action="{% url 'corehq.apps.app_manager.views.edit_module_attr' domain app.id module.id 'all' %}">
    {% csrf_token %}
    <div class="save-button-holder clearfix"></div>
    <fieldset>
        {% block settings_fields %}
        {% if request|toggle_enabled:"ONBOARDING_PROTOTYPE" and module.case_type != "" %}
        <legend>Basic</legend>
        <div class="form-group">
            <label class="col-sm-2 control-label">
                {% trans "Case Type" %}
                <span class="hq-help-template"
                      data-title="{% trans "Case Type" %}"

                      data-content="{% trans "The name for the type of case you are tracking (e.g. &quot;pregnancy&quot;, &quot;farm&quot;, &quot;household&quot;, etc.). All cases you register in this module will be this type of case, and only cases of this type will show in the case list. Other modules with the same case type will use the same set of cases." %}"
                        ></span>
            </label>
            <div class="col-sm-4">
                <input class="code form-control" type="text" id="case_type" name="case_type" value="{{ module.case_type }}" />
                <span class="help-block" id="case_type_error" style="display: none;"></span>
            </div>
        </div>
        {% endif %}
        {% if module.module_type == 'shadow' %}
        <div id="sourceModuleForms">
            <div class="form-group">
                <label class="col-sm-2 control-label">
                    {% trans "Source Module" %}
                </label>
                <div class="col-sm-4">
                    <select name="source_module_id" class="form-control"
                            data-bind="options: modules,
                                       optionsText: 'name',
                                       optionsValue: 'uniqueId',
                                       value: selectedModuleId"></select>
                </div>
            </div>
            <div class="form-group" data-bind="visible: selectedModule().forms().length">
                <label class="col-sm-2 control-label">
                    {% trans "Include Forms" %}
                </label>
                <div class="col-sm-4"
                     data-bind="template: {name: 'module-forms-template',
                                           foreach: selectedModule().forms()}"></div>
                <div class="hidden">
                    <select name="excl_form_ids"
                            multiple="multiple"
                            data-bind="options: selectedModule().forms,
                                       optionsText: 'name',
                                       optionsValue: 'uniqueId',
                                       selectedOptions: excludedFormIds"></select>
                    {# POST a value, even if no forms are excluded #}
                    <input name="excl_form_ids" type="checkbox" value="0" checked="">
                </div>
            </div>
        </div>
        {% endif %}
        {% if request|toggle_enabled:"ONBOARDING_PROTOTYPE" %}
            <legend>{% trans "Multimedia" %}</legend>
            {% include "app_manager/partials/nav_menu_media.html" with ICON_LABEL="Icon" AUDIO_LABEL="Audio" %}
            <legend>Advanced</legend>
                {% include "app_manager/partials/module_filter.html" with value=module.module_filter %}
                {% include "app_manager/partials/module_display_style.html" with value=module.module_filter %}
        {% else %}
            <div class="form-group">
                <label class="col-sm-2 control-label">
                    {% trans "Menu Mode" %}
                </label>
                <div class="col-sm-4">
                    <select type="text" name="put_in_root" class="form-control" id="put_in_root">
                        <option value="false">{% trans "Display module and then forms" %}</option>
                        <option value="true"{% if module.put_in_root %} selected{% endif %}>{% trans "Display only forms" %}</option>
                    </select>
                </div>
            </div>
            {% include "app_manager/partials/module_filter.html" with value=module.module_filter %}
            {% include "app_manager/partials/module_display_style.html" with value=module.module_filter %}
            {% include "app_manager/partials/nav_menu_media.html" with ICON_LABEL="Icon" AUDIO_LABEL="Audio" %}
        {% endif %}
        {% if child_module_enabled %}
        <div class="form-group">
            <label class="col-sm-2 control-label">
                {% trans "Parent Module" %}
            </label>
            <div class="col-sm-4">
                <select type="text" name="root_module_id" class="form-control">
                    <option value="">{% trans "No Parent" %}</option>
                    {% for mod in valid_parent_modules %}
                        <option value="{{mod.unique_id}}"{% if mod.unique_id == module.root_module_id %} selected{% endif %}>
                            {{ mod.name|trans:langs }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>
        {% endif %}
        {% endblock %}
    </fieldset>
</form>
