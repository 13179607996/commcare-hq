{% load i18n %}

<script type="text/html" id="remove-subcase-modal-template">
    <div class="modal-header">
        <a href="#" class="close" data-dismiss="modal">Ã—</a>
        <h3>{% trans "Remove Subcase?" %}</h3>
    </div>
    <div class="modal-body">
        <p>{% trans "Are you sure you want to remove this subcase?" %}</p>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal">{% trans "Cancel" %}</a>
        <a class="btn btn-danger" href="#" data-bind="click: $root.removeSubCase" data-dismiss="modal">{% trans "Remove Subcase" %}</a>
    </div>
</script>


<div id="case-config-ko">
    <div data-bind="saveButton: saveButton, visible: $root.edit"></div>
    <div class="indent">
        {% trans "Requires" %}
        <select data-bind="
            optstr: [{value: 'none', label: '{% trans "no case" %}'},
                      {value: 'case', label: '{% trans "a case" %}'}],
            value: requires
        "></select>
    </div>
    <div class="old-case-config"></div>
    <div data-bind="with: subCasesViewModel">
    <header class="clearfix">
        <h5 class="pull-left">{% trans "Child Cases" %}</h5>
        <span class="hq-help-template"
              data-title="{% trans "Child Cases" %}"
              data-content="{% trans "Child Cases let you open other types of cases for use in other modules. When possible, they'll be linked to the current case so you'll always know where they came from. A great use of Child Cases is for tracking a newborn separately from its mother." %}"
        ></span>
    </header>

    <div data-bind="foreach: subcases" class="indent form">
        <div>
            <i class="icon-ok"></i>
            {% trans "Opens a case for a different case list:" %}
            <span class="control-group" data-bind="css: {warning: !case_type()}">
                <select data-bind="
                    options: $parent.caseTypes,
                    optionsText: $parent.getCaseTypeLabel,
                    value: case_type,
                    optionsCaption: 'Choose a Module...',
                    edit: $root.edit"
                ></select>
                <span class="help-inline" data-bind="visible: !case_type()">{% trans "Required" %}</span>
            </span>
            <a href="#" data-bind="openModal: 'remove-subcase-modal-template', visible: $root.edit" style="float: right"><i class="icon-trash"></i>{% trans "Remove subcase" %}</a>
        </div>
        <div data-bind="visible: condition.type() === 'always' && $root.edit" class="indent">
            <a href="#" data-bind="click: function () {condition.type('if')}"><i class="icon-plus"></i> {% trans "Use condition..." %}</a>
        </div>
        <div data-bind="visible: condition.type() === 'if'" class="indent">
            <a href="#" data-bind="click: function () {condition.type('always')}, visible: $root.edit"><i class="icon-remove"></i></a>
            {% trans "If the answer to" %}
            <select data-bind="
                optstr: $root.getQuestions('select1', false, true),
                value: condition.question,
                optionsCaption: ' ',
                edit: $root.edit"
            ></select>
            {% trans "is" %}
            <span data-bind="if: $root.getAnswers({question: condition.question()}).length">
                <select data-bind="
                    optstr: $root.getAnswers({question: condition.question()}),
                    value: condition.answer,
                    edit: $root.edit"></select>
            </span>
            <span data-bind="if: !$root.getAnswers({question: condition.question()}).length">
                <input type="text" class="code" data-bind="value: condition.answer, edit: $root.edit"/>
            </span>
        </div>
        <div class="well" style="margin: 10px">
            <table>
                <thead>
                    <tr>
                        <th></th>
                        <th>{% trans "Question" %}</th>
                        <th>{% trans "Case Property" %}</th>
                    </tr>
                </thead>

                <tbody>
                    <tr class="control-group" data-bind="css: {warning: !case_name()}">
                        <td></td>
                        <td>
                            <select data-bind="
                                optstr: $root.getQuestions('all', false, true),
                                optstrText: $root.utils.getLabel,
                                value: case_name,
                                optionsCaption: ' ',
                                edit: $root.edit"
                            ></select>
                            <p class="help-block" data-bind="visible: !case_name()">{% trans "Required" %}</p>
                        </td>
                        <td>
                            <span class="label label-inverse">{% trans "Name" %}</span> <code>name</code>
                        </td>
                    </tr>
                </tbody>

                <tbody data-bind="foreach: case_properties">
                    <tr class="control-group" data-bind="css: {error: validate}">
                        <td>
                            <a href="#" data-bind="click: $parent.removeProperty, visible: $root.edit"><i class="icon-remove"></i></a>
                        </td>
                        <td>
                            <select data-bind="
                                optstr: $root.getQuestions('all', false, true),
                                optstrText: $root.utils.getLabel,
                                value: path,
                                optionsCaption: ' ',
                                edit: $root.edit"
                            ></select>
                        </td>
                        <td>
                            <input type="text" class="code" data-bind="valueDefault: key, default: defaultKey, edit: $root.edit"/>
                            <p class="help-inline" data-bind="html: validate"></p>
                        </td>
                    </tr>
                </tbody>
            </table>
            <a href="#" data-bind="click: addProperty, visible: $root.edit">{% trans "Add property" %}</a>
        </div>
    </div>
    <div class="indent">
        <a href="#" data-bind="click: addSubCase, visible: $root.edit">
            <i class="icon-plus"></i>
            {% trans "Opens a case for a different case list..." %}
        </a>
    </div>
    </div>
</div>
