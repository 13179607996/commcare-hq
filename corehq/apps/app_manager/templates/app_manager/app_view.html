{% extends "app_manager/managed_app.html" %}
{% load xforms_extras %}
{% block head %}
    {{ block.super }}
    <script>
        $(function(){
            $("#view_source").click(function(){
                $.get($(this).attr('href'), function(data){
                    $("#app_source").text(data);
                });
            });
        });
    </script>
{% endblock %}
{% block form-view %}
    <h3 class="variable-app_name">{{ app.name }}</h3>
    {% if app.doc_type == "Application" %}
        <h4>Application Settings</h4>
        <table class="config">
            <tr>
                <th>Name</th>
                <td>
                    {% if edit %}
                        <form method="post" action="{% url corehq.apps.app_manager.views.edit_app_attr domain app.id 'name' %}">
                            <input type="text" name="name" class="autosave" value="{{ app.name }}" />
                        </form>
                    {% else %}
                        
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>CommCare Users</th>
                <td>
                    {% if edit %}
                        <form method="post" action="{% url corehq.apps.app_manager.views.edit_app_attr domain app.id 'recipients' %}">
                            <input type="text" name="recipients" class="autosave sms-autocomplete" value="{{ app.recipients }}"/>
                        </form>
                    {% else %}
                        {{ app.recipients }}
                    {% endif %}
                </td>
            </tr>
        </table>
        <h4>Supported Languages</h4>
        <table class="config">
            <tbody {% if edit %}class="sortable"{% endif %}>
                <tr class="sort-action">
                    <td>
                        <form method="post" action="{% url corehq.apps.app_manager.views.rearrange domain app.id 'langs' %}">
                            <input name="ajax" value="true" />
                        </form>
                    </td>
                </tr>
                {% if edit %}
                    {% for lang in app.langs %}
                        <tr>
                            <td class="index">{{ forloop.counter0 }}</td>
                            <td>
                                <span class="drag_handle"></span>
                                {% with util.make_uuid as uuid %}
                                    <a class="delete_link" href="#" data-uuid="{{ uuid }}"></a>
                                    <div class="delete_dialog" title="Remove Language" data-uuid="{{ uuid }}">
                                        <form action="{% url corehq.apps.app_manager.views.delete_app_lang domain app.id%}" method="POST">
                                            <p>Removing this language will not permanently delete any translations you have made for it.</p>
                                            <input type="hidden" name="lang_id" value="{# filled in by js #}" />
                                            <input type="submit" value="Remove" />
                                        </form>
                                    </div>
                                {% endwith %}
                            </td>
                            <td>
                                <!--input class="code" type="text" name="lang" value={{ lang }} /-->
                                <div class="immutable"><code>{{ lang }}</code></div>
                            </td>
                            <!--td>
                                <input type="hidden" name="lang_id" value="{{ forloop.counter|add:-1 }}" />
                                <a href="{% url corehq.apps.app_manager.views.edit_app_lang domain app.id %}" class="submit button">
                                    Save
                                </a>
                                <div class="immutable">
                                    <a class="edit_link" href="#"></a>
                                </div>
                            </td-->
                        </tr>
                    {% endfor %}
                    <tr class="form sort-disabled" data-action="{% url corehq.apps.app_manager.views.edit_app_lang domain app.id %}">
                        <td>
                        </td>
                        <td>
                            <input class="code" type="text" name="lang" />
                        </td>
                        <td>
                            <a href="#" class="submit button">
                                Add
                            </a>
                        </td>
                    </tr>
                {% else %}
                    {% for lang in app.langs %}
                        <tr>
                            <td>
                                 <code>{{ lang }}</code>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td>
                                <p class="warning">No supported languages</p>
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
    {% endif %}
    {% if app.doc_type == "RemoteApp" %}
        <h4>Remote Setup</h4>
        <table class="config">
            {% if edit %}
                <tr class="form editable">
                    <th>Profile URL</th>
                    <td>
                        <input type="text" class="code wide" name="profile_url" />
                        <div class="immutable"><code>{{ app.profile_url }}</code></div>
                    </td>
                    <td>
                        <a href="{% url corehq.apps.app_manager.views.edit_app_attr domain app.id  'profile_url' %}" class="submit button">
                            Save
                        </a>
                        <div class="immutable">
                            <a class="edit_link" href="#"></a>
                        </div>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <th>Profile URL</th>
                    <td>
                        {{ app.profile_url }}
                    </td>
                </tr>
            {% endif %}
        </table>
    {% endif %}
    <h4>Advanced</h4>
    <div class="config">
        <a href="{% url corehq.apps.app_manager.views.app_source domain app.id %}" class="dialog_opener" id="view_source">View Source</a>
        <div class="dialog" title="Application Source">
            <textarea id="app_source"></textarea>
        </div>
    </div>
{% endblock %}