{% extends "app_manager/apps_base.html" %}
{% load url from future %}
{% load i18n %}
{% load hq_shared_tags %}

{% block js-inline %}{{ block.super }}
    <script src="{% static 'hqwebapp/js/lib/compression.js' %}"></script>
    <script>
        $(function () {
            $(".historyBack").click(function () {
                history.back();
                return false;
            });
        });

        function MyViewModel(){
            var self = this;
            self.compressed_app_data = ko.observable("");
            self.compress_app = function(formElement) {
                self.compressed_app_data(LZW.compress(formElement['source'].value));
                formElement['source'].value = '';
                return true;
            };
        }
        ko.applyBindings(new MyViewModel());
    </script>
{% endblock %}

{% block breadcrumbs %}
    <li><span class="divider">&gt;</span> {% trans 'Import Application' %}</li>
{% endblock %}

{% block main_column %}
    <form action="{% url "corehq.apps.app_manager.views.import_app" domain %}" method="post" data-bind="submit: compress_app">
{% if app %}
        <p>Import application <strong>{{ app.name }}</strong> from domain <strong>{{ app.domain }}</strong>?</p>
        <table {% if not is_superuser %}class="hide"{% endif %}>
{% else %}
        <p>Paste your application definition into the box below.</p>
        <table>
{% endif %}
            <tr>
                <th>Name:</th>
                <td><input type="text" name="name"/></td>
            </tr>
            <tr>
                <th>Source:</th>
                <td><textarea name="source">{{ app.export_json }}</textarea></td>
            </tr>
        </table>
        <a href="#" class="historyBack">No, take me back.</a>
        <button class="btn btn-primary" type="submit">{% trans 'Yes, import application' %}</button>
        <input name="compressed" type="hidden" data-bind="value: compressed_app_data">
    </form>
{% endblock %}
