{% load i18n %}
{% load hq_shared_tags %}
<div id="key_value_mapping_editable_template" class="hide">
    <form class="form-horizontal hq-enum-editor" action="">
            <div data-bind="visible: values_are_icons">
                <tr>
                    <strong class="span2">{% trans 'Condition' %}</strong>
                    <strong class="span2">{% trans 'Icon Path' %}</strong>
                    <strong class="span2">{% trans 'Icon' %}</strong>
                    <br>
                </tr>
            </div>
            <br>
        <fieldset data-bind="sortable: items">
            <div class="control-group hq-input-map"
                 data-bind="css: {'error': $parent.isItemDuplicated(ko.utils.unwrapObservable(key))},
                            attr: {'data-order': _sortableOrder}">
                <i class="sortable-handle icon-resize-vertical" style="cursor: move;"></i>
                <input type="text"
                       class="input-small enum-key"
                       placeholder="key"
                       data-bind="value: key"/>
                &rarr;
                <input type="text" class="input-large enum-value" data-bind="
                    attr: {placeholder: $parent.backup(value()).value},
                    value: value()[$parent.lang],
                    visible: !$parent.values_are_icons
                "/>
                <!-- ko if: $parent.values_are_icons -->
                <span data-bind="template: {name: 'value_icon_uploader', data: iconManager}">
                </span>
                <!-- /ko -->
                <a href="#" data-bind="click: $parent.removeItem" class="btn btn-danger pull-right">
                    <i class="icon icon-white icon-remove"></i>
                </a>
                <a href="#" class="btn btn-inverse btn-mini lang-text"
                   style="color:#ffffff; text-decoration: none;"
                   data-bind="
                    text: $parent.backup(value()).lang,
                    visible: !_([$parent.lang, null]).contains($parent.backup(value()).lang)
                "></a>
                <span class="help-inline"
                      data-bind='visible: $parent.isItemDuplicated(ko.utils.unwrapObservable(key))'>Key is duplicated.</span>
            </div>
        </fieldset>

        <div class="control-group">
            <a href="#" class="btn btn-success"
               data-bind="click: addItem">
                <i class="icon icon-white icon-plus"></i>
                Add kKey &rarr; Value Mapping
            </a>
        </div>
    </form>
</div>

<div id="key_value_mapping_modal" class="hide">
    <div class="modal hide fade hq-enum-modal">
        <div class="modal-header">
            <a class="close" data-dismiss="modal">Ã—</a>
            <h3 data-bind="text: $data.modalTitle"></h3>
        </div>
        <div class="modal-body" style="max-height:372px; overflow-y: scroll;"
             data-bind="template: {name: 'key_value_mapping_editable_template', data: mapList}"></div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" data-dismiss="modal"
                    data-bind="disable: ko.utils.unwrapObservable($data.mapList.duplicatedItems).length > 0,
                    text: (ko.utils.unwrapObservable($data.mapList.duplicatedItems).length > 0) ? 'Fix errors' : 'OK',
                    click: save"></button>
        </div>
    </div>
</div>

<div id="key_value_mapping_display_template" class="hide">
    <div data-bind="foreach: items">
        <div>
            <strong data-bind="text: key"></strong>
            &rarr;
            <span data-bind="visible: value()[$parent.lang], text: value()[$parent.lang]"></span>
            <span data-bind="visible: !ko.utils.unwrapObservable(value()[$parent.lang])">
                <i class="icon-remove-sign"></i>
            </span>
        </div>
    </div>
</div>

<div id="key_value_mapping_template" class="hide">
    <div data-bind="template: 'key_value_mapping_display_template'"></div>
    <button class="btn" data-bind="click: openModal, visible: $data.edit">
        <i class="icon-pencil"></i>
        <span data-bind="text: $data.buttonText"></span>
    </button>
</div>

<script type="text/html" id="value_icon_uploader" class="hide">
    <input type="text" class="span2"
           data-bind="value: customPath,
                      valueUpdate: 'textchange',
                      attr: {placeholder: defaultPath}" />
    <a data-bind="if: isMediaMatched, attr: {href: url}" target="_blank">
        <img data-bind="attr: {src: thumbnailUrl}" />
    </a>
    <button type="button" class="btn" data-toggle="modal"  data-target="#hqimage"
            data-bind="attr: { 'data-hqmediapath': currentPath },
                       event: {
                            mediaUploadComplete: uploadComplete,
                            click: passToUploadController
                       }">
        <i class="icon icon-cloud-upload"></i>
        <span data-bind="visible: isMediaMatched">{% trans 'Replace' %}</span>
        <span data-bind="visible: isMediaUnmatched">{% trans 'Upload' %}</span>
    </button>
</script>