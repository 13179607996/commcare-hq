{% load i18n %}
{% load hq_shared_tags %}
<div id="key_value_mapping_editable_template" class="hide">
    <form class="form-horizontal hq-enum-editor" action="">
        <fieldset data-bind="sortable: items">
            <div class="control-group hq-input-map"
                 data-bind="css: {'error': $parent.isItemDuplicated(ko.utils.unwrapObservable(key))}">
                <i class="sortable-handle icon-resize-vertical"></i>
                <input type="text"
                       class="input-small enum-key"
                       placeholder="key"
                       data-bind="value: key"/>
                &rarr;
                <input type="text" class="input-large enum-value" data-bind="
                    attr: {placeholder: $parent.backup(value()).value},
                    value: value()[$parent.lang],
                    visible: !$parent.values_are_icons
                "/>
                <a href="#" class="btn btn-inverse btn-mini lang-text"
                   style="color:#ffffff; text-decoration: none;"
                   data-bind="
                    text: $parent.backup(value()).lang,
                    visible: !_([$parent.lang, null]).contains($parent.backup(value()).lang)
                "></a>
                <a href="#" data-bind="click: $parent.removeItem" class="btn btn-danger">
                    <i class="icon icon-white icon-remove"></i> Delete
                </a>
                <span class="help-inline"
                      data-bind='visible: $parent.isItemDuplicated(ko.utils.unwrapObservable(key))'>Key is duplicated.</span>
                <div class="modal-body" style="max-height:372px; overflow-y: scroll;"
                     data-bind="template: {name: 'value_icon_uploader', data: mediaValue},
                                visible: $parent.values_are_icons"></div>
            </div>
        </fieldset>

        <div class="control-group">
            <a href="#" class="btn btn-success"
               data-bind="click: addItem">
                <i class="icon icon-white icon-plus"></i>
                Add kKey &rarr; Value Mappinggg
            </a>
        </div>
        <div data-bind="if: values_are_icons">no pare is a message. Astonishing.</div>
    </form>
</div>

<div id="key_value_mapping_modal" class="hide">
    <div class="modal hide fade hq-enum-modal">
        <div class="modal-header">
            <a class="close" data-dismiss="modal">Ã—</a>
            <h3 data-bind="text: $data.modalTitle"></h3>
        </div>
        <div class="modal-body" style="max-height:372px; overflow-y: scroll;"
             data-bind="template: {name: 'key_value_mapping_editable_template', data: mapList}"></div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" data-dismiss="modal"
                    data-bind="disable: ko.utils.unwrapObservable($data.mapList.duplicatedItems).length > 0,
                    text: (ko.utils.unwrapObservable($data.mapList.duplicatedItems).length > 0) ? 'Fix errors' : 'OK',
                    click: save"></button>
        </div>
    </div>
</div>

<div id="key_value_mapping_display_template" class="hide">
    <div data-bind="foreach: items">
        <div>
            <strong data-bind="text: key"></strong>
            &rarr;
            <span data-bind="visible: value()[$parent.lang], text: value()[$parent.lang]"></span>
            <span data-bind="visible: !ko.utils.unwrapObservable(value()[$parent.lang])">
                <i class="icon-remove-sign"></i>
            </span>
        </div>
    </div>
</div>

<div id="key_value_mapping_template" class="hide">
    <div data-bind="template: 'key_value_mapping_display_template'"></div>
    <button class="btn" data-bind="click: openModal, visible: $data.edit">
        <i class="icon-pencil"></i>
        <span data-bind="text: $data.buttonText"></span>
    </button>
</div>

<div id="value_icon_uploader" class="hide" style="display: inline">
    <a data-bind="if: isMediaMatched, attr: {href: url}" target="_blank">
        <img data-bind="attr: {src: thumbnailUrl}" />
    </a>
    <button type="button" class="btn" data-toggle="modal"  data-target="#hqimage"
            data-bind="attr: { 'data-hqmediapath': currentPath },
                       event: {
                            mediaUploadComplete: uploadComplete,
                            click: passToUploadController
                       }">
        <i class="icon icon-cloud-upload"></i>
        <span data-bind="visible: isMediaMatched">{% trans 'Replace' %}</span>
        <span data-bind="visible: isMediaUnmatched">{% trans 'Upload' %}</span>
    </button>
    <button type="button" class="btn btn-default pull-right"
            data-bind="
                visible: showDefaultPath,
                click: setCustomPath">
        <i class="icon icon-cog"></i>
        {% trans 'Set Path' %}
    </button>
    <label class="control-label">{% trans "Path" %}</label>
    <input type="text" class="span3"
           data-bind="value: customPath,
                      valueUpdate: 'textchange',
                      visible: showCustomPath" />
    <button type="button" class="btn inline"
            data-bind="
                visible: showCustomPath,
                event: { click: setDefaultPath }
            ">
        <i class="icon icon-remove"></i>
        {% trans 'Use Default Path' %}
    </button>
</div>