{% extends "groups/all_groups.html" %}
{% load i18n %}
{% load hq_shared_tags %}
{% block head %}
    {{ block.super }}
    <style>
        h2 {
            font-weight: normal;
            font-size: 1.5em;
        }
        .user-bubbles {
            margin: 1.5em;
        }
        .user-bubble {
            float: left;
            padding: .5em;
            margin:  .25em;
            cursor: pointer;
        }
        .non-member:hover, .member {
            background-color: #eee;
            border: 1px solid #888;
            color: black;
        }
        .non-member, .member:hover {
            background-color: white;
            border: 1px solid #eee;
            color: #666;
        }
        .delete_this_group {
            float: right;
        }

        #group-layout > tbody > tr > td:first-child {
            border-right: 1px solid #CCC;
        }
        .edit-group-name-popup {
            border: 1px solid #ccc;
            position: absolute;
            background-color: white;
            padding: 10px;
        }
        .edit-group-name-popup div {
            padding-top: 10px;
        }
    </style>
    <script>
        $(function () {
            var groupName = {{ group.name|JSON }},
                selectedGroupTab = $('#group-list > .selected'),
                pencil = $('<span/>').addClass('ui-icon ui-icon-pencil').css({'float': 'right'}),
                editLink = $('<a href="#"/>').append(pencil).click(function (e) {
                        e.preventDefault();
                        var offset = pencil.offset();
                        offset.top -= editorPopup.outerHeight();
                        offset.left += pencil.outerWidth();
                        Shield.open(editorPopup.css(offset));
                        $("#group-name-input").focus().select();
                    }).prependTo(selectedGroupTab),
                editorPopup = $('<div/>').addClass('edit-group-name-popup ui-widget shadow ui-corner-top ui-corner-br');
            $('<form/>').attr({method: "POST", action: "{% url edit_group domain group.get_id %}"}).append(
                $('<label for="group-name-input"/>').text('Group Name: '),
                $('<input type="text" id="group-name-input"/>').attr({name: 'name'}).val(groupName),
                $('<div/>').append(
                    $('<a href="#"/>').addClass('submit button').text("Save").css('float', 'right'),
                    $('<a href="#"/>').addClass('button').text('Cancel').css('float', 'right').click(function (e) {
                        e.preventDefault();
                        Shield.close();
                    })
                )
            ).appendTo(editorPopup);
            editorPopup.appendTo($('body')).hide();
            COMMCAREHQ.initBlock(editorPopup);
        });
    </script>
{% endblock %}

{% block group-view %}
<div>
    <div class="delete_this_group">
          <form  name="delete_group" action="{% url delete_group domain group.get_id %}" method="POST">
              <a href="#" class="submit"><span class="ui-icon ui-icon-trash" href="#"></span>Delete this group</a>
          </form>
    </div>
    <br style="clear: both;"/>
    <div class="user-bubbles">
        {% for member in members %}
            <form name="leave_group" action="{% url leave_group domain group.get_id member.user_id %}" method="POST">
                <div class="user-bubble member ui-corner-all submit">
                    <input type="hidden" name="redirect_url" value="group_members" />
                    <a class="delete_link submit" href="#"></a>
                    <span>{{ member.raw_username }}</span>
                </div>
            </form>
        {% endfor %}
        <br style="clear: both;">
    </div>
    <div class="user-bubbles">
        {% for nonmember in nonmembers %}
            <form name="join_group" action="{% url join_group domain group.get_id nonmember.get_id %}" method="POST">
                <div class="user-bubble non-member ui-corner-all submit">
                    <input type="hidden" name="redirect_url" value="group_members" />
                    <a class="new_link" href="#"></a>
                    <span>{{ nonmember.raw_username }}</span>
                </div>
            </form>
        {% endfor %}
    </div>
</div>
{% endblock %}

