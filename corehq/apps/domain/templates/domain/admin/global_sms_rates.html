{% extends "hqwebapp/two_column.html" %}
{% load hqstyle_tags %}
{% load hq_shared_tags %}
{% load crispy_forms_tags %}
{% load i18n %}

{% block js %}{{ block.super }}
    <script src="{% static 'hqwebapp/js/lib/select2/select2.js' %}"></script>
    <script src="{% static 'smsbillables/ko/smsbillables.rate_calc.js' %}"></script>
{% endblock %}

{% block head %}{{ block.super }}
    <link href="{% static 'hqwebapp/js/lib/select2/select2.css' %}" rel="stylesheet" />
{% endblock %}

{% block js-inline %}{{ block.super }}
    <script>
        var smsRateCalculator = new PublicSMSRateCalculator({
            country_code: {
                fieldName: 'country_code',
                currentValue: ''
            }
        });
        ko.applyBindings(smsRateCalculator, $('#sms-rate-calculator').get(0));
        $("#id_country_code").select2()
    </script>
{% endblock %}

{% block title %}{% trans "SMS Pricing" %}{% endblock %}

{% block page-title %}
    <ul class="breadcrumb">
        <li>
            <a href="/software-plans/"><strong>{% trans "Pricing" %}</strong></a> <span class="divider">&gt;</span>
        </li>
        <li class="active">
            <p>{% trans "SMS Pricing" %}</p>
        </li>
    </ul>
{% endblock %}

{% block main_column %}
    <header>
        <div class="row-fluid">
            <div class="span8">
                <h2>
                    {% blocktrans %}
                        Pricing for Dimagi Gateways
                    {% endblocktrans %}
                </h2>
                <p>
                    {% blocktrans %}
                        Use this form to get a cost estimation per 160 character SMS, for a given country. The fee will be applied to the most specific criteria available. A fee for a specific country code (if available) will be used over the default of 'Any Country'.
                        </br>
                        Fees are subject to change based on updates to each carrier and are computed at the time the SMS is sent.
                    {% endblocktrans %}
                </p>
            </div>
        </div>
    </header>
    <hr />
    <div id="sms-rate-calculator">
        {% crispy rate_calc_form %}
        <div class="alert alert-success" data-bind="visible: calculatingRate">
            {% blocktrans %}
            Calculating SMS Rate...
            {% endblocktrans %}
        </div>
        <div class="alert"
             data-bind="text: rate,
                        css: { 'alert-error': hasError, 'alert-info': noError },
                        visible: showRateInfo"></div>
        <table class="table table-striped table-bordered" style="margin-bottom:0">
            <thead>
                <tr>
                    <th>
                        {% trans "Connection" %}
                    </th>
                    <th>
                        {% trans "Incoming" %}
                    </th>
                    <th>
                        {% trans "Outgoing" %}
                    </th>
                </tr>
            </thead>
            <tbody>
                <!-- ko foreach: rate_table -->
                    <tr>
                        <td>
                            <span data-bind="text: gateway"></span>
                        </td>
                        <td>
                            <span data-bind="text: inn"></span>
                        </td>
                        <td>
                            <span data-bind="text: out"></span>
                        </td>
                    </tr>
                <!-- /ko -->
            </tbody>
        </table>
    </div>
{% endblock %}
