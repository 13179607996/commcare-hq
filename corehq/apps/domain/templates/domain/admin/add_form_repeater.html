{% extends "settings/bootstrap3/base_template.html" %}
{% load i18n %}
{% load hqstyle_tags %}
{% load hq_shared_tags %}
{% load crispy_forms_tags %}

{% block js-inline %} {{ block.super }}
    <script type="text/javascript">
        $(function() {
            var $testLinkButton = $('#test-forward-link'),
                $testResult = $('#test-forward-result');
            $testLinkButton.click(function () {
                var data = {
                    url: $('#id_url').val(),
                    format: $('#id_format').val(),
                    type: {{ repeater_type|to_javascript_string }}
                };

                $.post("{% url "test_repeater" domain %}", data, function(resp) {
                    var jsonResp = JSON.parse(response),
                        message;
                    $testResult.removeClass("hide bg-danger bg-success");
                    if (jsonResp.status) {
                        message = jsonResp.status + ": " + jsonResp.response;
                    } else {
                        message = jsonResp.response;
                    }
                    if (jsonResp.success) {
                        $testResult.addClass("bg-success");
                        $testResult.text("{% trans 'Success! Response is' %}: " + message);
                    } else {
                        $testResult.addClass("bg-danger");
                        $testResult.text("{% trans 'Failed! Response is' %}: " + message);
                    }
                });
            });
            $('#id_url').after($testLinkButton);
            $testLinkButton.after($testResult.addClass('hide'));
            $('#id_url').change(function () {
                if ($(this).val()) {
                    $testLinkButton.removeClass('hide');
                } else {
                    $testLinkButton.addClass('hide');
                }
            });
        });
    </script>
{% endblock %}

{% block page_content %}
    {% crispy form %}
{% endblock %}
