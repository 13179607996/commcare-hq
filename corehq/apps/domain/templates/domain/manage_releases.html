{% extends "hqwebapp/base_section.html" %}
{% load hq_shared_tags %}
{% load crispy_forms_tags %}
{% load i18n %}

{% requirejs_main 'app_manager/js/manage_releases' %}

{% block page_content %}
    {% initial_page_data 'enabled_app_releases' enabled_app_releases %}
    {% registerurl 'deactivate_release_restriction' domain '---'%}
    {% registerurl 'activate_release_restriction' domain '---'%}
    <div class="row">
        <div class="col-sm-12">
            <div class="panel panel-modern-gray panel-form-only">
                <div class="panel-body">
                    <form class="form-horizontal disable-on-submit" id="manage-app-releases" action=""
                          method='post'>
                        {% crispy manage_releases_form %}
                    </form>
                {% if enabled_app_releases %}
                    <table id="managed-releases" class="table">
                        <thead>
                            <tr>
                                <th class="col-sm-2">{% trans 'Application' %}</th>
                                <th class="col-sm-2">{% trans 'Location' %}</th>
                                <th class="col-sm-2">{% trans 'Version' %}</th>
                                <th class="col-sm-4">{% trans 'Last Activity' %}</th>
                                <th class="col-sm-2">{% trans 'Action' %}</th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: enabledAppReleases, visible: enabledAppReleases">
                            <tr data-bind="attr: {id: domId}, css: {'bg-success': active() }">
                                <td data-bind="text: app"></td>
                                <td data-bind="text: location"></td>
                                <td data-bind="text: version"></td>
                                <td>
                                    <div data-bind="visible: activatedOn">
                                        {% trans 'Activated On : ' %}
                                        <span data-bind="text: activatedOn"></span>
                                    </div>
                                    <div data-bind="visible: deactivatedOn">
                                        {% trans 'Deactivated On : ' %}
                                        <span data-bind="text: deactivatedOn"></span>
                                    </div>
                                </td>
                                <td>
                                    <button type="button" class="" data-bind="click: toggleRestriction">
                                        <span data-bind="text: actionText"></span>
                                        <i class="spinner fa-spin fa fa-refresh"
                                           data-bind="visible: ajaxInProgress"></i>
                                    </button>
                                    <br/>
                                    <span class="error-message label label-danger" data-bind="visible: error">
                                        {% trans 'Could not update!' %}
                                        <span data-bind="text: errorMessage"></span>
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}