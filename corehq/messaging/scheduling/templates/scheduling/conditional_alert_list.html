{% extends "hqwebapp/base_section.html" %}
{% load hq_shared_tags %}
{% load i18n %}

{% requirejs_main "scheduling/js/conditional_alert_list" %}

{% block stylesheets %}{{ block.super }}
<style>
    .label {
        font-size: 100%;
    }
</style>
{% endblock %}

{% block page_content %}
    {% registerurl 'conditional_alert_list' domain %}
    {% registerurl 'edit_conditional_alert' domain '---' %}
    {% initial_page_data 'limit_rule_restarts' limit_rule_restarts %}
    {% initial_page_data 'allow_copy' allow_copy %}

    <div class="btn-group">
        <a href="{% url 'create_conditional_alert' domain %}" class="btn btn-primary">
            <i class="fa fa-plus"></i>
            {% trans "New Conditional Alert" %}
        </a>
    </div>
    <h4>{% trans 'Conditional Alerts' %}</h4>
    <div>
        <table id="conditional-alert-list" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th class="col-md-1">{% trans 'Delete' %}</th>
                    <th class="{% if allow_copy %}col-md-2{% else %}col-md-5{% endif %}">{% trans 'Name' %}</th>
                    <th class="col-md-2">{% trans 'Case Type' %}</th>
                    <th class="col-md-2">{% trans 'Status' %}</th>
                    <th class="col-md-2">{% trans 'Action' %}</th>
                    {% if allow_copy %}
                        <th class="col-md-3">{% trans 'Copy To' %}</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody data-bind="foreach: rules">
                <tr>
                    <td class="text-center">
                        <button data-bind="attr: {id: 'delete-button-for-' + id()},
                                           disable: locked_for_editing,
                                           click: remove"
                                class="btn btn-danger">
                                <i class="fa fa-remove"></i>
                        </button>
                    </td>
                    <td><a data-bind="attr: {href: editUrl}, text: name"></a></td>
                    <td data-bind="text: case_type"></td>
                    <td>
                        <span class="label label-success" data-bind="visible: active()">{% trans "Active" %}</span>
                        <span class="label label-danger" data-bind="visible: !active()">{% trans "Inactive" %}</span>
                        <span class="label label-default" data-bind="visible: locked_for_editing()">
                            {% trans "Processing" %}: <span data-bind="text: progress_pct"></span>%
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-default"
                                data-bind="attr: {id: 'activate-button-for-' + id()},
                                           disable: locked_for_editing() || !editable(),
                                           click: toggleStatus">
                            <span data-bind="visible: active()">{% trans "Deactivate" %}</span>
                            <span data-bind="visible: !active()">{% trans "Activate" %}</span>
                        </button>
                        <div data-bind="visible: locked_for_editing">
                            <button class="btn btn-default" data-bind="click: restart">
                                <i class="fa fa-refresh"></i> {% trans "Restart Rule" %}
                            </button>
                        </div>
                    </td>
                    {% if allow_copy %}
                        <td>
                            <div class="form-inline">
                                <input type="text" placeholder="{% trans_html_attr "Project" %}" class="form-control copy-project-name" data-bind="value: projectName" />
                                <button class="btn btn-default"
                                        data-bind="attr: {id: 'copy-button-for-' + id()},
                                                  disable: locked_for_editing() || !editable(),
                                                  click: copy,">
                                    <i class="fa fa-copy"></i>
                                    {% trans "Copy" %}
                                </button>
                            </div>
                        </td>
                    {% endif %}
                </tr>
            </tbody>
        </table>
    </div>
{% endblock %}
