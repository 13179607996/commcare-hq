{% load i18n %}
{% load basic_tags %}

<h2>{% trans "Data for Schema: " %}{{form_name}}</h2>
{% if filters %}
	<h3>FILTERED BY
		{{filters}}
	{% if sort_params %}
		<a href="{% url xformmanager.views.data xform.id %}?{{sort_params}}">(Click here to remove filters)</a>
	{% else %}
		<a href="{% url xformmanager.views.data xform.id %}">(Click here to remove filters)</a>
	{% endif %}
	</h3>

	<br/>
{% endif %}
<br/>

<a href="{% url xformmanager.views.single_xform xform.id %}">more information about this schema</a>
<br>
<a href="{% url xformmanager.views.export_xml xform.id %}">download zip file of xml submissions</a>
<br>
<a href="{% url xformmanager.views.export_csv xform.id %}">download csv file</a>
<br>
{% if errors %}
    <p class="error">{{ errors }}</p>
{% endif %}
<br>
<div class="pagination">
    <span class="step-links">
        {% if data.has_previous %}
            <a href="?{{param_string_no_page}}&page={{ data.previous_page_number }}"><< Previous</a>
        {% endif %}
        <span class="current">
            Page {{ data.number }} of {{ data.paginator.num_pages }}.
        </span>
        {% if data.has_next %}
            <a href="?{{param_string_no_page}}&page={{ data.next_page_number }}">Next >></a>
        {% endif %}
    </span>
</div>
<form action="{% url xformmanager.views.delete_data xform.id %}" method="POST">
<table class="sofT">
	<thead class="commcare-heading">
	   <tr>
	      <th></th>
	   {% for col in columns %}
	      {% ifequal forloop.counter0 sort_index %}
		     <th class="sorted" id="{% if sort_descending %}descending{% else %}ascending{% endif %}">
		       <a href="?sort_column={{col}}&sort_descending={% if sort_descending %}false{% else %}true{% endif %}&filter_{{filters}}">
		         {{col}}
		     </th>
          {% else %}
		     <th><a href="?sort_column={{col}}&filter_{{filters}}">{{col}}</th>
          {% endifequal %}          	
	   {% endfor%}
	   </tr>
	</thead>
    {% for record in data.object_list %}
    <tr class="{% cycle 'odd' 'even' %}">
       <td>
	       <input type="hidden" name="instance" value="{{record|first}}"/>
	       <input type="checkbox" name="checked_{{record|first}}"/>
       </td>
       {% for field in record %}
           {% ifequal forloop.counter0 sort_index %}
                <td class="sorted">
           {% else %}
                <td>
           {% endifequal %}
           {% if forloop.first %}
	   		     <a href = "{%url xformmanager.views.single_instance xform.id field %}">&nbsp;{{ field }}&nbsp;</a>
	   	   {% else %}
	   	  		 {% comment %} rO - for some reason, this doesn't work. why? {% endcomment %}
	   	  		 {% if filtered_by %} 
		   	   		 {% ifequal filtered_by columns|get_index:forloop.counter0 %}
			   		     {{field}}
		   	   		 {% else %}
		   	   		 	{% if sort_params %}
				   		     <a href="?filter_{{ columns|get_index:forloop.counter0 }}={{field}}&{{sort_params}}">
		   	   		 	{% else %}
				   		     <a href="?filter_{{ columns|get_index:forloop.counter0 }}={{field}}">
		   	   		 	{% endif %}
			   		     	{{field}}
			   		     </a>
		   	   		 {% endifequal %}
    	   		 {% else %}
		   	   		 	{% if sort_params %}
				   		     <a href="?filter_{{ columns|get_index:forloop.counter0 }}={{field}}&{{sort_params}}">
		   	   		 	{% else %}
				   		     <a href="?filter_{{ columns|get_index:forloop.counter0 }}={{field}}">
		   	   		 	{% endif %}
			   		     	{{field}}
			   		     </a>
	   	   		 {% endif %}
	       {% endif %} 
	   	   </td>
	   {% endfor %}
	</tr>
   {% endfor %}
</table>

{% if data.object_list %}   	
<input type="submit" value="Delete" />
{% endif %}   	

</form>




