{% extends "xformmanager_base.html" %}
{% load i18n %}
{% block title %}Upload your xforms here{% endblock %}
{% block javascripts %}
    <script type="text/javascript" src="{{MEDIA_URL}}/hq/javascripts/jqModal.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}/hq/javascripts/jqDnR.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}/xformmanager/javascripts/form_group.js"></script>
    <script type="text/javascript">
    alert('hello!');
    $('#formlist').jqm({ajax: '/receiver/annotations/', trigger: 'div.annotationtrigger'},
                        ajaxText: 'Please wait while we load that for you'}););
    </script>
{% endblock %}
{% block mgr_content %}

<div class="fieldWrapper{% if form.message.errors %} errors{% endif %}">
    {% if form.message.errors %}
        <ol>
        {% for error in form.message.errors %}
            <li><strong>{{ error|escape }}</strong></li>
        {% endfor %}
        </ol>
    {% endif %}
    {{ form.message }}
</div>

<div class="fieldWrapper{% if errors %} errors{% endif %}">
    {% if errors %}
            <li><strong>{%trans "Submit Error: "%}{{ errors|escape|linebreaks }}</strong></li>
    {% endif %}
</div>

<div id="xform-register-block">
<h1>Register a New XForm*</h1>
Whenever you change a form, be sure to update the xmlns, as this is the <strong>only</strong> mechanism by which CommCareHQ identifies form submissions.
If you change a form and do not update the xmlns, CommCareHQ will try to map new submissions on to the old form - often resulting in lost or misinterpreted data. 
<form action="" method="POST" enctype="multipart/form-data">
<table>
{{ upload_form.as_ul}}
</table>
<input type="submit" value="Submit" />
</form>
{% if newsubmit %}
	<p>{% trans "Registration successful for xform id:"%}{{newsubmit.id}}</p>
{% endif %}
</div>

<h2>{% trans "Registered XForms" %}</h2>

<strong>
<ol>
      
    <table class="sofT">
        <thead class="commcare-heading">
   		   <tr>
                <th>{% trans "Name" %}</th>
                <th>{% trans "XMLNS" %}</th>
                <th>{% trans "Forms" %}</th>
                <th>{% trans "Versions" %}</th>
                <th>{% trans "First Registered" %}</th>
                <th>{% trans "Last Received" %}</th>
                <th></th>
   		   </tr>
   		</thead>
   		{% for group in form_groups %}   
   		<tr class="{% cycle "odd" "even" %}">
   			<td>{{ group.display_name }}</td>
   			<td>{{ group.xmlns }}</td>
   			<td>
   			<div class="formtrigger js_link" onclick="show_forms('{{group.xmlns}}', '#formlist');">{{ group.forms|length }}</div>
   			</td>
   			<td>{{ group.version_string }}</td>
   			<td>{% blocktrans with group.first_date_registered|date as date_t %}
	   				{{date_t}}
	   			{% endblocktrans %}
   			</td>
            <td>{% if group.last_received %}
		   			{% blocktrans with group.last_received|date as date_t %}
		   				{{date_t}}
		   			{% endblocktrans %}
		   		{% else %}
		   			n/a
		   		{% endif %}
   			</td>
   			
   			
   		</tr>
   		{% endfor %}   		
   </table>
   

</ol>
</strong>

*Note that files are processed as <a href="http://code.javarosa.org/wiki/xform">XForms</a>, unless they have a ".xsd" extension, in which case they are processed as <a href="http://www.w3schools.com/Schema/default.asp">XML Schema</a>.

<div class="message_log" id="formlist">
Hello World
</div>
{% endblock %}

