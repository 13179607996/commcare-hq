<script type="text/javascript"> 
    $(document).ready(function() { 
        $('#add_annotation').click(function() {
            attach_id = {{ attachment.id }};
            msg_area = $('#new_annotation');
            message = msg_area[0].value;
            
            var done = function(status) {
                if (status == "success") {
                    $.blockUI({ message: "<h1>Annotation successfully added!</h1>" });
                } else {
                    $.blockUI({ message: "<h1>Sorry - we had a problem adding your annotation!</h1>" });
                }
                setTimeout($.unblockUI, 1000);
            };
            
            send_xhr = $.ajax({
                        "type": "POST",
                        "url":  "/receiver/annotations/new/",
                        "data": {
                            "attach_id":  attach_id,
                            "text": message,
                        },
                        "success": function()    { done("success"); },
                        "error":   function() { done("error"); }
                    });
            
            
        });
    });
        
</script>
<a href="#" class="jqmClose">Close</a><br>
{% if annotations %}
    {% for annotation in annotations %}
        <div class="annotation">
            <div class="annotation-date">{{ annotation.date|date }}</div>
            <div class="annotation-body">{{ annotation.text }}</div>
        </div>
    {% endfor %}
{% else %}
    No Annotations.
{% endif %}
<textarea id="new_annotation" rows="4" cols="40"></textarea>
<input id="add_annotation" class="jqmClose" type="button" value="Add" />
<input id="close" class="jqmClose" type="button" value="Close" />
